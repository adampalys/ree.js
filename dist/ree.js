var REE={};REE.Revision="0.0.1";
!function(){"use strict";REE.Property=function(e){this["default"]=e.value,this.type=e.type,this.observer=void 0,this.notify=!1,this.writable=!0,this.persist=!1,this.enumerable=!0,e&&this.define(e)},REE.Property.protptype.define=function(e){void 0!==e.value&&(this["default"]=e.value),void 0!==e.type&&(this.type=e.type),void 0!==e.observer&&(this.observer=e.observer),void 0!==e.notify&&(this.notify=e.notify),void 0!==e.writable&&(this.writable=e.writable),void 0!==e.persist&&(this.persist=e.persist),void 0!==e.enumerable&&(this.enumerable=e.enumerable)}}();
!function(){"use strict";REE.Element=function(e){Object.defineProperties(this,{_config:{value:e||{}},_properties:{value:{}},_effects:{value:{}},_targetEffects:{value:{}},_debouncers:{value:{}},_listeners:{value:{}},_parents:{value:[]},_children:{value:{}}}),this.registerProperties({uuid:{value:THREE.Math.generateUUID(),type:String,observer:"_uuidChanged"}})},REE.Element.prototype.registerProperty=function(e,t,i){void 0===this._properties[e]?this._properties[e]=new REE.Property(t):this._properties[e].define(t);var s=this._properties[e];i instanceof Array&&i[0]instanceof REE.Element&&"string"==typeof i[1]?s["default"]=i[0][i[1]]:i&&(s["default"]=i);var r,n=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+"-changed";if(!this.hasOwnProperty(e)){var o={key:e,element:this};Object.defineProperty(this,e,{get:function(){return s.value},set:function(t){if(s.value!==t){if(s.writable===!1&&void 0!==s.value&&console.warn("REE.Element: "+e+" is read only."),s.type&&void 0!==t)if(s.type===String){if("string"!=typeof t)return void console.warn("REE.Element: "+e+" is incorrect type.")}else if(s.type===Boolean){if("boolean"!=typeof t)return void console.warn("REE.Element: "+e+" is incorrect type.")}else if(s.type===Number){if("number"!=typeof t)return void console.warn("REE.Element: "+e+" is incorrect type.")}else if("function"==typeof s.type&&!(t instanceof s.type))return void console.warn("REE.Element: "+e+" is incorrect type.");r=s.value,s.value=t,r instanceof REE.Element&&(r._parents.splice(r._parents.indexOf(o),1),delete this._children[e]),t instanceof REE.Element&&(t._parents.push(o),this._children[e]=t),this.debounce(n,function(){void 0!==s.observer&&this[s.observer].call(this,{value:t,oldValue:r}),s.notify===!0&&this.dispatchEvent({type:n,key:e,value:t,oldValue:r}),s.persist===!0&&this.setPersistedValue(e,t)}.bind(this))}},enumerable:s.enumerable})}i instanceof Array&&i[0]instanceof REE.Element&&"string"==typeof i[1]&&i[0].bindProperty(this,i[1],e),s.persist?this[e]=this.getPersistedValue(e):this[e]=s["default"]},REE.Element.prototype.registerProperties=function(e){for(var t in e){var i=e[t],s=this._config[t];this.registerProperty(t,i,s)}},REE.Element.prototype.bindProperty=function(e,t,i){var s=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+"-changed",r=i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+"-changed";this._properties[t].notify=!0,e._properties&&e._properties[i]&&(e._properties[i].notify=!0),this._effects[s]=function(){e[i]=this[t]}.bind(this),this._targetEffects[r]=function(){this[t]=e[i]}.bind(this),this._targetEffects[r].target=e,this.addEventListener(s,this._effects[s]),e.addEventListener(r,this._targetEffects[r]),void 0!==this[t]?e[i]=this[t]:void 0!==e[i]&&(this[t]=e[i])},REE.Element.prototype.bindProperties=function(e,t){for(var i in t)this.bindProperty(e,i,t[i])},REE.Element.prototype.addEventListener=function(e,t){void 0===this._listeners[e]&&(this._listeners[e]=[],this._listeners[e].regExp=new RegExp("^"+e.replace(/[*]/g,".*").toLowerCase().trim()+"$")),-1===this._listeners[e].indexOf(t)&&this._listeners[e].push(t)},REE.Element.prototype.removeEventListener=function(e,t){if(void 0!==this._listeners[e]){var i=this._listeners[e].indexOf(t);-1!==i&&this._listeners[e].splice(i,1)}},REE.Element.prototype.dispatchEvent=function(e){var t=e.type,i=[];for(var s in this._listeners)this._listeners[s].regExp.test(t)&&(i=i.concat(this._listeners[s]));if(e.target=e.target||this,void 0!==i)for(var r=0;r<i.length;r++)i[r].call(this,e);if(e.bubble===!0)for(var n=0;n<this._parents.length;n++)e.type=this._parents[n].key+"."+t,this._parents[n].element.dispatchEvent(e)},REE.Element.prototype.setPersistedValue=function(e,t){var i=JSON.stringify(t);localStorage.setItem(this.uuid+"_"+e,i)},REE.Element.prototype.getPersistedValue=function(e){var t=localStorage.getItem(this.uuid+"_"+e),i=this._propertes[e].type;if(null!==t){if(i===Number||i===String||i===Boolean)t=JSON.parse(t);else if("function"==typeof i){var s=JSON.parse(t);t=new i;for(var r in s)t[r]=s[r]}return t}return this._propertes[e]["default"]},REE.Element.prototype.debounce=function(e,t,i){window.clearTimeout(this._debouncers[e]),this._debouncers[e]=setTimeout(function(){t(),delete this._debouncers[e]}.bind(this),i)},REE.Element.prototype._uuidChanged=function(e){if(e.oldValue)for(var t in this._properties)this._propertes[t].persist&&(this[t]=this.getPersistedValue(t))},REE.Element.prototype.dispose=function(){var e,t;for(e in this._properties)delete this._properties[e];for(e in this._effects)this.removeEventListener(e,this._effects[e]),delete this._effects[e];delete this._effects;for(e in this._targetEffects)this._targetEffects[e].target.removeEventListener(e,this._targetEffects[e]),delete this._targetEffects[e];delete this._targetEffects;for(e in this._debouncers)window.clearTimeout(this._debouncers[e]),delete this._debouncers[e];delete this._debouncers;for(e in this._listeners){for(t=this._listeners[e].length;t--;)this.removeEventListener(e,this._listeners[e][t]);delete this._listeners[e]}delete this._listeners,this._parents.length=0,delete this._parents;for(e in this._children)delete this._children[e];delete this._children}}();
!function(){REE.Helper=function(e){THREE.Object3D.call(this),REE.Element.call(this,e)},REE.Helper.prototype=Object.create(THREE.Object3D.prototype),REE.Helper.prototype.constructor=REE.Helper,REE.Helper.prototype.registerProperty=REE.Element.prototype.registerProperty,REE.Helper.prototype.registerProperties=REE.Element.prototype.registerProperties,REE.Helper.prototype.bindProperty=REE.Element.prototype.bindProperty,REE.Helper.prototype.bindProperties=REE.Element.prototype.bindProperties,REE.Helper.prototype.dispose=REE.Element.prototype.dispose,REE.Helper.prototype.debounce=REE.Element.prototype.debounce,REE.Helper.prototype.addEventListener=REE.Element.prototype.addEventListener,REE.Helper.prototype.removeEventListener=REE.Element.prototype.removeEventListener,REE.Helper.prototype.dispatchEvent=REE.Element.prototype.dispatchEvent,REE.Helper.prototype._setPersistedValue=REE.Element.prototype._setPersistedValue,REE.Helper.prototype._getPersistedValue=REE.Element.prototype._getPersistedValue,REE.Helper.prototype._uuidChanged=REE.Element.prototype._uuidChanged,REE.Helper.prototype.update=function(){}}();
!function(){var t=new THREE.Matrix4,i=new THREE.Vector3;REE.CompassHelper=function(t){REE.Helper.call(this,t),this.registerProperties({axis:{value:new THREE.AxisHelper(1),type:THREE.AxisHelper,writable:!1},visible:{value:!0,type:Boolean},size:{value:.25,type:Number}}),this.axis.matrixAutoUpdate=!1,this.axis.material.linewidth=2,this.axis.material.depthTest=!1,this.axis.frustumCulled=!1,this.matrixAutoUpdate=!1,this.add(this.axis)},REE.CompassHelper.prototype=Object.create(REE.Helper.prototype),REE.CompassHelper.prototype.constructor=REE.CompassHelper,REE.CompassHelper.prototype.update=function(e){if(e){this.matrix.identity(),t.identity(),this.matrix.multiply(e.matrixWorld),t.identity(),this.axis.matrix.identity(),this.axis.matrix.multiply(t.getInverse(t.extractRotation(e.matrixWorld))),t.identity(),t.makeTranslation(0,0,0),this.axis.matrix.multiply(t),t.identity(),this.matrix.multiply(t.getInverse(e.projectionMatrix)),i.set(1,1,1).applyProjection(e.projectionMatrix);var a=this.size*i.x/i.y,s=this.size;t.identity(),t.makeTranslation(1-a,1-s,0),this.matrix.multiply(t),t.identity(),t.makeScale(a,s,1),this.matrix.multiply(t)}}}();
!function(){"use strict";var i=new THREE.Vector3,t=new THREE.Vector3,e=new THREE.Matrix4,r=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),o=new THREE.Vector3(0,0,1);REE.GridHelper=function(i){REE.Helper.call(this,i),this.registerProperties({showAxis:{value:!0,type:Boolean},axisSize:{value:10,type:Number},showGrid:{value:!0,type:Boolean},gridSize:{value:10,type:Number,observer:"updateGrid"},gridWidth:{value:10,type:Number,observer:"updateGrid"},gridColor1:{value:"white",type:String,observer:"updateGrid"},gridColor2:{value:"#222",type:String,observer:"updateGrid"}}),this._grid=new THREE.GridHelper(this.gridSize*this.gridWidth,this.gridSize),this._grid.setColors(this.gridColor1,this.gridColor2),this._grid.material.transparent=!0,this._grid.material.opacity=.5,this._grid.material.depthWrite=!1,this.add(this._grid),this._axis=new THREE.AxisHelper,this._axis.material.depthTest=!1,this.add(this._axis),this.update()},REE.GridHelper.prototype=Object.create(REE.Helper.prototype),REE.GridHelper.prototype.constructor=REE.GridHelper,REE.GridHelper.prototype.updateGrid=function(){var i=new THREE.GridHelper(this.gridSize*this.gridWidth,this.gridSize);i.setColors(this.gridColor1,this.gridColor2),this._grid.geometry=i.geometry},REE.GridHelper.prototype.update=function(d){this._grid.visible=this.showGrid===!0,this._axis.visible=this.showAxis===!0,this._axis.scale.set(this.axisSize,this.axisSize,this.axisSize),d&&(e.extractRotation(d.matrixWorld.clone()),i.copy(o.multiplyScalar(1)).applyMatrix4(e),t.set(i.dot(r),i.dot(s),i.dot(o)),d instanceof THREE.PerspectiveCamera?t.treshold=.999:t.treshold=.7071,Math.abs(t.z)>t.treshold?this._grid.rotation.set(Math.PI/2,0,0):Math.abs(t.x)>t.treshold?this._grid.rotation.set(0,0,Math.PI/2):this._grid.rotation.set(0,0,0))}}();
!function(){REE.BoxHelper=function(e){REE.Helper.call(this,e),Object.defineProperties(this,{_bboxHelper:{value:new THREE.BoxHelper(new THREE.Mesh(new THREE.BoxGeometry(1,1,1,1,1,1)))}}),this._bboxHelper.material.depthTest=!1,this.add(this._bboxHelper)},REE.BoxHelper.prototype=Object.create(REE.Helper.prototype),REE.BoxHelper.prototype.constructor=REE.BoxHelper}();
!function(){REE.SceneState=function(e){THREE.Scene.call(this),REE.Element.call(this,e),this.registerProperties({_helpers:{value:new THREE.Scene,type:THREE.Scene,writable:!1}})},REE.SceneState.prototype=Object.create(THREE.Scene.prototype),REE.SceneState.prototype.constructor=REE.SceneState,REE.SceneState.prototype.registerProperty=REE.Element.prototype.registerProperty,REE.SceneState.prototype.registerProperties=REE.Element.prototype.registerProperties,REE.SceneState.prototype.bindProperty=REE.Element.prototype.bindProperty,REE.SceneState.prototype.bindProperties=REE.Element.prototype.bindProperties,REE.SceneState.prototype.dispose=REE.Element.prototype.dispose,REE.SceneState.prototype.debounce=REE.Element.prototype.debounce,REE.SceneState.prototype.addEventListener=REE.Element.prototype.addEventListener,REE.SceneState.prototype.removeEventListener=REE.Element.prototype.removeEventListener,REE.SceneState.prototype.dispatchEvent=REE.Element.prototype.dispatchEvent,REE.SceneState.prototype._setPersistedValue=REE.Element.prototype._setPersistedValue,REE.SceneState.prototype._getPersistedValue=REE.Element.prototype._getPersistedValue,REE.SceneState.prototype._uuidChanged=REE.Element.prototype._uuidChanged}();
!function(){"use strict";var t={persp:new THREE.PerspectiveCamera(30,1,.1,1e4),top:new THREE.OrthographicCamera(25,-25,25,-25,-1e3,1e3),bottom:new THREE.OrthographicCamera(25,-25,25,-25,-1e3,1e3),front:new THREE.OrthographicCamera(25,-25,25,-25,-1e3,1e3),back:new THREE.OrthographicCamera(25,-25,25,-25,-1e3,1e3),left:new THREE.OrthographicCamera(25,-25,25,-25,-1e3,1e3),right:new THREE.OrthographicCamera(25,-25,25,-25,-1e3,1e3)};t.persp.position.set(300,300,300),t.persp.lookAt(new THREE.Vector3),t.top.rotation.set(-Math.PI/2,0,-Math.PI/2),t.top.position.set(0,100,0),t.bottom.rotation.set(Math.PI/2,0,-Math.PI/2),t.bottom.position.set(0,-100,0),t.front.position.set(0,0,100),t.back.rotation.set(0,Math.PI,0),t.back.position.set(0,0,-100),t.left.rotation.set(0,Math.PI/2,0),t.left.position.set(100,0,0),t.right.rotation.set(0,-Math.PI/2,0),t.right.position.set(-100,0,0);for(var e=0;e<t.length;e++)t[e]._target=new THREE.Vector3;var a=[{label:"persp",value:t.persp},{label:"top",value:t.top},{label:"bottom",value:t.bottom},{label:"front",value:t.front},{label:"back",value:t.back},{label:"left",value:t.left},{label:"right",value:t.right}];REE.CamerasState=function(e){REE.Element.call(this,e),this.registerProperties({persp:{value:t.persp,type:THREE.Camera},top:{value:t.top,type:THREE.Camera},bottom:{value:t.bottom,type:THREE.Camera},front:{value:t.front,type:THREE.Camera},back:{value:t.back,type:THREE.Camera},right:{value:t.right,type:THREE.Camera},left:{value:t.left,type:THREE.Camera},options:{value:a,type:Array}})},REE.CamerasState.prototype=Object.create(REE.Element.prototype),REE.CamerasState.prototype.constructor=REE.CamerasState,REE.CamerasState.prototype.update=function(){}}();
!function(){"use strict";REE.ConfigState=function(e){REE.Element.call(this,e),this.registerProperties({clearColor:{value:"#222222",type:String,notify:!0,persist:!0},showHelpers:{value:!0,type:Boolean,notify:!0,persist:!0},showAxis:{value:!0,type:Boolean,notify:!0,persist:!0},axisSize:{value:10,type:Number,notify:!0,persist:!0},showGrid:{value:!0,type:Boolean,notify:!0,persist:!0},gridSize:{value:10,type:Number,notify:!0,persist:!0},gridWidth:{value:10,type:Number,notify:!0,persist:!0},gridColor1:{value:"white",type:String,notify:!0,persist:!0},gridColor2:{value:"#222",type:String,notify:!0,persist:!0},snapAngle:{value:45,type:Number,notify:!0,persist:!0},showCompass:{value:!0,type:Boolean,notify:!0,persist:!0},compassSize:{value:.125,type:Number,notify:!0,persist:!0}})},REE.ConfigState.prototype=Object.create(REE.Element.prototype),REE.ConfigState.prototype.constructor=REE.ConfigState,REE.ConfigState.prototype.update=function(){}}();
!function(){"use strict";REE.ControlsState=function(t){REE.Element.call(this,t),this.registerProperties({scene:{type:REE.SceneState},selectionControl:{value:new REE.SelectionControl,type:REE.SelectionControl,vritable:!1},viewportControl:{value:new REE.ViewportControl,type:REE.ViewportControl,vritable:!1},control:{type:REE.Control,notify:!0},selector:{value:"transform:translate",type:String,observer:"_selectorChanged",notify:!0},mode:{type:String,observer:"_modeChanged",notify:!0},snapDistance:{type:Number},snapAngle:{type:Number}}),this.selectionControl.scene=this.scene},REE.ControlsState.prototype=Object.create(REE.Element.prototype),REE.ControlsState.prototype.constructor=REE.ControlsState,REE.ControlsState.prototype._selectorChanged=function(){var t=this.selector.split(":")[0],e=this.selector.split(":")[1]||"";if(this._name!==t){var o=t.charAt(0).toUpperCase()+t.slice(1)+"Control";this.control&&this.control.dispose(),this.mode=e,this.control=new REE[o],this.bindProperty(this.control,"scene","scene"),this.bindProperty(this.control,"mode","mode"),this.bindProperty(this.control,"snapDistance","snapDistance"),this.bindProperty(this.control,"snapAngle","snapAngle"),this.control.addEventListener("active-changed",function(){this.control.active?(this.viewportControl.enabled=!1,this.selectionControl.enabled=!1,this.selectionControl.helper.visible=!1):(this.viewportControl.enabled=!0,this.selectionControl.enabled=!0,this.selectionControl.helper.visible=!0)}.bind(this)),this._name=t}this.mode=e},REE.ControlsState.prototype._modeChanged=function(){this.debounce("mode-changed",function(){this.mode?this.selector=this._name+":"+this.mode:this.selector=this._name}.bind(this))}}();
!function(){var t,e=new THREE.Box3;REE.SelectionState=function(t){REE.Element.call(this,t),this.registerProperties({objects:{value:[],type:Array,writable:!1},center:{value:new THREE.Vector3,type:THREE.Vector3,writable:!1},box:{value:new THREE.Box3,type:THREE.Box3,writable:!1},sphere:{value:new THREE.Sphere,type:THREE.Sphere,writable:!1}})},REE.SelectionState.prototype=Object.create(REE.Element.prototype),REE.SelectionState.prototype.constructor=REE.SelectionState,REE.SelectionState.prototype.clear=function(){this.remove([].concat(this.objects)),this.update()},REE.SelectionState.prototype.add=function(t){t instanceof THREE.Object3D&&(t=[t]);for(var e=0;e<t.length;e++)-1===this.objects.indexOf(t[e])&&this.objects.push(t[e]);this.update()},REE.SelectionState.prototype.remove=function(t){t instanceof THREE.Object3D&&(t=[t]);for(var e=t.length;e--;)-1!==this.objects.indexOf(t[e])&&this.objects.splice(this.objects.indexOf(t[e]),1);this.update()},REE.SelectionState.prototype.toggle=function(t){t instanceof THREE.Object3D&&(t=[t]);for(var e=t.length;e--;)-1!==this.objects.indexOf(t[e])?this.objects.splice(this.objects.indexOf(t[e]),1):this.objects.push(t[e]);this.update()},REE.SelectionState.prototype.selectParents=function(){for(var t=[],e=0;e<this.objects.length;e++)this.objects[e].parent&&t.push(this.objects[e].parent);this.clear(),this.add(t)},REE.SelectionState.prototype.selectChildren=function(){for(var t=[],e=0;e<this.objects.length;e++)this.objects[e].children.length&&t.push(this.objects[e].children[0]);this.clear(),this.add(t)},REE.SelectionState.prototype.selectNext=function(){for(var t=[],e=0;e<this.objects.length;e++)if(this.objects[e].parent){var i=this.objects[e].parent.children.indexOf(this.objects[e]);i=(i+1)%this.objects[e].parent.children.length,t.push(this.objects[e].parent.children[i])}this.clear(),this.add(t)},REE.SelectionState.prototype.selectPrevious=function(){for(var t=[],e=0;e<this.objects.length;e++)if(this.objects[e].parent){var i=this.objects[e].parent.children.indexOf(this.objects[e]);i=(this.objects[e].parent.children.length+i-1)%this.objects[e].parent.children.length,t.push(this.objects[e].parent.children[i])}this.clear(),this.add(t)},REE.SelectionState.prototype.update=function(){this.debounce("update",function(){if(this.box.makeEmpty(),this.sphere.empty(),this.center.set(0,0,0),0!==this.objects.length){for(var i=0;i<this.objects.length;i++)t=this.objects[i],e.setFromObject(t),this.box.expandByPoint(e.min),this.box.expandByPoint(e.max);this.center.copy(this.box.min).add(this.box.max).multiplyScalar(.5),this.box.getBoundingSphere(this.sphere)}this.dispatchEvent({type:"selection-changed",bubble:!0,value:this})}.bind(this))}}();
!function(){var e=document.createElement("div");e.className="three-control",e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.bottom=0,e.style.right=0,e.style.zIndex=1e7,e.style.cursor="move";var t,n=new THREE.Raycaster,o=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Matrix4,a=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),l=new THREE.Vector3(0,0,1),c=new THREE.Mesh(new THREE.PlaneBufferGeometry(1e6,1e6,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide}));c.rotation.set(Math.PI/2,0,0),c.updateMatrixWorld();var p=new REE.SelectionState;REE.Control=function(t){function n(e){g.enabled!==!1&&(M=m(e.path[0]),M&&(g.domElement=e.path[0],g.camera=m(e.path[0]).camera,y=O(e,!0),"function"==typeof g.onTrackstart&&g.onTrackstart(e,y),window.addEventListener("mousemove",o),window.addEventListener("mouseup",r)))}function o(t){return g.enabled===!1?(window.removeEventListener("mousemove",o),void window.removeEventListener("mouseup",r)):(y=O(t),"function"==typeof g.onTrack&&g.onTrack(t,y),void(e.parentNode!==document.body&&document.body.appendChild(e)))}function r(t){window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",r),e.parentNode===document.body&&document.body.removeChild(e),g.enabled!==!1&&(y=O(t),"function"==typeof g.onTrackend&&g.onTrackend(t,y))}function i(e){g.enabled!==!1&&(M=m(e.path[0]),M&&(g.domElement=M.domElement,g.camera=M.camera,y=O(e),"function"==typeof g.onHover&&g.onHover(e,y)))}function a(e){e.preventDefault(),e.path[0].focus(),g.enabled!==!1&&(M=m(e.path[0]),M&&(g.domElement=M.domElement,g.camera=M.camera,C=!0,setTimeout(function(){C=!1}),y=O(e,!0),"function"==typeof g.onHover&&g.onHover(e,y),"function"==typeof g.onTrackstart&&g.onTrackstart(e,y),e.path[0].addEventListener("touchmove",s),e.path[0].addEventListener("touchend",l)))}function s(t){return t.preventDefault(),g.enabled===!1?(t.path[0].removeEventListener("touchmove",s),void t.path[0].removeEventListener("touchend",l)):void(C!==!0&&(y=O(t),"function"==typeof g.onTrack&&g.onTrack(t,y),e.parentNode!==document.body&&document.body.appendChild(e)))}function l(t){t.preventDefault(),t.path[0].removeEventListener("touchmove",s),t.path[0].removeEventListener("touchend",l),e.parentNode===document.body&&document.body.removeChild(e),g.enabled!==!1&&"function"==typeof g.onTrackend&&g.onTrackend(t,y)}function d(e){M=m(e.path[0]),M&&(e.preventDefault(),g.enabled!==!1&&(b=0,e.wheelDelta?b=-e.wheelDelta:e.detail&&(b=10*e.detail),"function"==typeof g.onMousewheel&&g.onMousewheel(e,b)))}function u(e){M=m(e.path[0]),M&&g.enabled!==!1&&"function"==typeof g.onKeyup&&g.onKeyup(e,e.which)}function h(e){M=m(e.path[0]),M&&(e.preventDefault(),g.enabled!==!1&&"function"==typeof g.onContextmenu&&g.onContextmenu(e))}function m(e){return g._viewports.find(function(t){return t.domElement===e})}REE.Element.call(this,t),Object.defineProperties(this,{helper:{value:new THREE.Object3D,writable:!1,enumerable:!0},plane:{value:c.clone(),writable:!1,enumerable:!0},_viewports:{value:[]}}),this.helper.add(this.plane),this.helper.update=function(){this.updatePlaneOrientation()}.bind(this),this.registerProperties({camera:{type:THREE.Camera,notify:!0},domElement:{type:HTMLElement,notify:!0},scene:{type:THREE.Scene,observer:"addHelper",notify:!0},selection:{value:p,type:REE.Selection,writable:!1},active:{type:Boolean,notify:!0},mode:{type:String,notify:!0},snapDistance:{type:Number},snapAngle:{type:Number},enabled:{value:!0,type:Boolean,notify:!0}});var E,v,f,y,w,b,R,T,L,H,D,M,g=this,C=!1,k=function(e,t){return E=g.domElement.getBoundingClientRect(),new THREE.Vector2((e-E.left)/E.width*2-1,1-(t-E.top)/E.height*2)},x=function(e,t){H=t[0];for(var n=1;n<t.length;n++)t[n].distanceTo(e)<H.distanceTo(e)&&(H=t[n]);return H},O=function(e,t){v=e.touches?e.touches:[e],T=t?[]:w||[],R=t?[]:R||[],w=[],L=[],D=[];for(var n=0;n<v.length;n++)(v[n].target===e.path[0]||void 0===e.touches)&&(f=k(v[n].clientX,v[n].clientY),w.push(f),void 0===T[w.length-1]&&T.push(f.clone()),void 0===R[w.length-1]&&R.push(f.clone()));var o=[];for(n=0;n<w.length;n++)L[n]=w[n].clone().sub(x(w[n],T)),D[n]=w[n].clone().sub(x(w[n],R)),o[n]={position:w[n],previous:T[n],delta:L[n],offset:D[n]};return o};this.registerViewport=function(e,t){M=m(e),M?t&&(M.camera=t):(M={domElement:e,camera:t},g._viewports.push(M),e.addEventListener("mousedown",n),e.addEventListener("touchstart",a),e.addEventListener("mousewheel",d),e.addEventListener("DOMMouseScroll",d),e.addEventListener("mousemove",i),e.addEventListener("keyup",u),e.addEventListener("contextmenu",h))},this.unregisterViewport=function(e){M=m(e),M&&(e.removeEventListener("mousedown",n),e.removeEventListener("touchstart",a),e.removeEventListener("mousewheel",d),e.removeEventListener("DOMMouseScroll",d),e.removeEventListener("mousemove",i),e.removeEventListener("keyup",u),e.removeEventListener("contextmenu",h),g._viewports.splice(g._viewports.indexOf(M),1))}},REE.Control.prototype=Object.create(REE.Element.prototype),REE.Control.prototype.constructor=REE.Control,REE.Control.prototype.dispose=function(){REE.Element.prototype.dispose.call(this);var e;for(e=this._viewports.length;e--;)this.unregisterViewport(this._viewports[e].domElement);this.helper&&this.helper.parent&&this.helper.parent.remove(this.helper)},REE.Control.prototype.updatePlaneOrientation=function(){void 0!==this.camera&&(i.extractRotation(this.camera.matrixWorld.clone()),o.copy(l.multiplyScalar(1)).applyMatrix4(i),r.set(o.dot(a),o.dot(s),o.dot(l)),this.camera instanceof THREE.PerspectiveCamera?r.treshold=.999:r.treshold=.65,Math.abs(r.z)>r.treshold?this.plane.lookAt(l):Math.abs(r.x)>r.treshold?this.plane.lookAt(a):this.plane.lookAt(s))},REE.Control.prototype.getPointOnPlane=function(e,o){return n.setFromCamera(e,this.camera),t=n.intersectObjects([this.plane],!0)[0],t?(o===!0&&this.snapDistance&&(t.point.x=Math.round(t.point.x/this.snapDistance)*this.snapDistance,t.point.y=Math.round(t.point.y/this.snapDistance)*this.snapDistance,t.point.z=Math.round(t.point.z/this.snapDistance)*this.snapDistance),t.point):void 0},REE.Control.prototype.addHelper=function(){this.helper&&this.scene._helpers.add(this.helper)}}();
!function(){"use strict";var e,t=new THREE.Raycaster;REE.SelectionControl=function(o){function n(e,o){t.setFromCamera(e,i.camera),s=t.intersectObjects([i.scene],!0)[0],s?(c=s.object,o?i.selection.toggle(c):(i.selection.clear(),i.selection.add(c))):o||i.selection.clear()}REE.Control.call(this,o),this.helper.add(new REE.BoxHelper),this.helper.scale.set(1/0,1/0,1/0),this.addEventListener("selection.selection-changed",function(){e=this.selection.box.max.clone().sub(this.selection.box.min),this.helper.position.copy(this.selection.center),this.helper.scale.copy(e),this.dispatchEvent({type:"render",renderAll:!0,bubble:!0})}.bind(this));var s,c,i=this;this.onTrackend=function(e,t){t[0].offset.length()<.01&&n(t[0].position,e.shiftKey)},this.onKeyup=function(e,t){switch(t){case 38:i.selection.selectParents(c);break;case 40:i.selection.selectChildren(c);break;case 39:i.selection.selectNext(c);break;case 37:i.selection.selectPrevious(c)}}},REE.SelectionControl.prototype=Object.create(REE.Control.prototype),REE.SelectionControl.prototype.constructor=REE.SelectionControl}();
!function(){"use strict";var t,a,e,r,i,o,c,s,h=new THREE.Vector3,n=new THREE.Matrix3,m=1e-6;REE.ViewportControl=function(t){REE.Control.call(this,t);var a=this;this.onTrack=function(t,e){if("mousemove"===t.type)0===t.button&&(a.camera instanceof THREE.OrthographicCamera?a.pan(e[0].delta):a.rotate(e[0].delta)),1===t.button&&a.zoom(e[0].delta),2===t.button&&a.pan(e[0].delta);else if("touchmove"===t.type)switch(e.length){case 1:a.camera instanceof THREE.PerspectiveCamera?a.rotate(e[0].delta):a.camera instanceof THREE.OrthographicCamera&&a.pan(e[0].delta);break;case 2:var r=e[0].previous.distanceTo(e[1].previous),i=e[0].position.distanceTo(e[1].position);r&&(a.zoom(new THREE.Vector2(0,r-i)),a.pan(e[0].delta.clone().add(e[1].delta).multiplyScalar(.5)))}},this.onTrackend=function(){a.camera.dispatchEvent({type:"changed"})},this.onMousewheel=function(t,e){void 0!==this.camera&&a.zoom(new THREE.Vector2(0,e/1e3))},this.onKeyup=function(t,e){70===e&&a.focusSelection()}},REE.ViewportControl.prototype=Object.create(REE.Control.prototype),REE.ViewportControl.prototype.constructor=REE.ViewportControl,REE.ViewportControl.prototype.rotate=function(r){this.camera._target=this.camera._target||new THREE.Vector3,h.copy(this.camera.position).sub(this.camera._target),t=Math.atan2(h.x,h.z),a=Math.atan2(Math.sqrt(h.x*h.x+h.z*h.z),h.y),t-=3*r.x,a-=3*-r.y,a=Math.max(m,Math.min(Math.PI-m,a)),e=h.length(),h.x=e*Math.sin(a)*Math.sin(t),h.y=e*Math.cos(a),h.z=e*Math.sin(a)*Math.cos(t),this.camera.position.copy(this.camera._target).add(h),this.camera.lookAt(this.camera._target),this.dispatchEvent({type:"render",bubble:!0})},REE.ViewportControl.prototype.pan=function(t){this.camera._target=this.camera._target||new THREE.Vector3,r=this.camera.position.distanceTo(this.camera._target),h.set(-t.x,-t.y,0),this.camera instanceof THREE.PerspectiveCamera?(i=r*Math.tan(this.camera.fov/2*Math.PI/180),h.multiplyScalar(i),h.x*=this.camera.aspect):this.camera instanceof THREE.OrthographicCamera&&(h.x*=(this.camera.right-this.camera.left)/2,h.y*=(this.camera.top-this.camera.bottom)/2),h.applyMatrix3(n.getNormalMatrix(this.camera.matrix)),this.camera.position.add(h),this.camera._target.add(h),this.dispatchEvent({type:"render",bubble:!0})},REE.ViewportControl.prototype.zoom=function(t){if(this.camera._target=this.camera._target||new THREE.Vector3,this.camera instanceof THREE.PerspectiveCamera){var a=this.camera.position.distanceTo(this.camera._target);if(h.set(0,0,t.y),h.multiplyScalar(a),h.length()>a)return;h.applyMatrix3(n.getNormalMatrix(this.camera.matrix)),this.camera.position.add(h)}else this.camera instanceof THREE.OrthographicCamera&&(this.camera.top*=1+t.y,this.camera.right*=1+t.y,this.camera.bottom*=1+t.y,this.camera.left*=1+t.y);this.dispatchEvent({type:"render",bubble:!0})},REE.ViewportControl.prototype.focusSelection=function(){if(this.camera._target=this.camera._target||new THREE.Vector3,this.selection&&this.selection.objects.length&&this.selection.spheREE.radius){var t=this.selection.spheREE.radius,a=this.camera.position.clone().sub(this.camera._target);if(this.camera instanceof THREE.PerspectiveCamera){this.camera._target.copy(this.selection.center);var e=Math.tan(this.camera.fov/2*Math.PI/180);a.normalize().multiplyScalar(t/e),this.camera.position.copy(this.camera._target).add(a),this.camera.lookAt(this.camera._target)}else this.camera instanceof THREE.OrthographicCamera&&(this.camera._target.copy(this.selection.center),this.camera.position.copy(this.camera._target).add(a),o=this.camera.right-this.camera.left,c=this.camera.top-this.camera.bottom,s=o/c,1>s?(this.camera.top=t/s,this.camera.right=t,this.camera.bottom=-t/s,this.camera.left=-t):(this.camera.top=t,this.camera.right=t*s,this.camera.bottom=-t,this.camera.left=-t*s));this.dispatchEvent({type:"render",bubble:!0})}}}();
!function(){"use strict";REE.SphereControl=function(e){REE.Control.call(this,e);var t,o,i,n=new THREE.Mesh(new THREE.SphereGeometry(1,32,32),new THREE.MeshBasicMaterial({color:16777215,wireframe:!0}));this.onTrackstart=function(e,o){e.altKey||(t=this.getPointOnPlane(o[0].position,e.shiftKey),t&&(this.helper.add(n),n.visible=!1,n.position.copy(t),this.active=!0))},this.onTrack=function(e,r){e.altKey||(o=this.getPointOnPlane(r[0].position,e.shiftKey),o&&(i=t.distanceTo(o),i>0&&(n.scale.set(i,i,i),n.visible=!0,this.dispatchEvent({type:"render",bubble:!0}))))},this.onTrackend=function(e){if(!e.altKey){if(this.helper.remove(n),i>0){var o=new THREE.Mesh(new THREE.SphereGeometry(i,32,32),new THREE.MeshNormalMaterial({color:16777215}));o.position.copy(t),this.scene.add(o),this.selection.clear(),this.selection.add(o)}this.active=!1,i=0,this.dispatchEvent({type:"render",renderAll:!0,bubble:!0})}}},REE.SphereControl.prototype=Object.create(REE.Control.prototype),REE.SphereControl.prototype.constructor=REE.SphereControl}();
!function(){"use strict";var t,e,i,o=new THREE.Vector3,a=new THREE.Quaternion,n=new THREE.Matrix4,s=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),l=new THREE.Vector3(0,0,1),c=new THREE.Vector3(0,0,0),h=new THREE.Raycaster;REE.TransformControl=function(t){function i(){for(var t=E.selection.objects,e=0;e<t.length;e++)t[e]._positionStart=t[e].position.clone(),t[e]._quaternionStart=t[e].quaternion.clone(),t[e]._scaleStart=t[e].scale.clone()}function o(t){for(var e=E.selection.objects,i=E.axis,o=E.space,n=0;n<e.length;n++)"local"===o?e[n].position.copy(V).applyQuaternion(e[n]._quaternionStart):e[n].position.copy(f),e[n].position.add(e[n]._positionStart),t&&E.snapDistance&&("local"===o&&(e[n].position.applyQuaternion(a.copy(e[n]._quaternionStart).inverse()),-1!==i.search("X")&&(e[n].position.x=Math.round(e[n].position.x/E.snapDistance)*E.snapDistance),-1!==i.search("Y")&&(e[n].position.y=Math.round(e[n].position.y/E.snapDistance)*E.snapDistance),-1!==i.search("Z")&&(e[n].position.z=Math.round(e[n].position.z/E.snapDistance)*E.snapDistance),e[n].position.applyQuaternion(e[n]._quaternionStart)),"world"===o&&(e[n].parent&&e[n].position.add(z.setFromMatrixPosition(e[n].parent.matrixWorld)),-1!==i.search("X")&&(e[n].position.x=Math.round(e[n].position.x/E.snapDistance)*E.snapDistance),-1!==i.search("Y")&&(e[n].position.y=Math.round(e[n].position.y/E.snapDistance)*E.snapDistance),-1!==i.search("Z")&&(e[n].position.z=Math.round(e[n].position.z/E.snapDistance)*E.snapDistance),e[n].parent&&e[n].position.sub(z.setFromMatrixPosition(e[n].parent.matrixWorld))))}function n(){for(var t=E.selection.objects,e=0;e<t.length;e++)t[e].scale.copy(t[e]._scaleStart).multiply(H)}function c(t){var i=E.selection.objects,o=E.axis,a=E.space;("E"===o||"XYZE"===o)&&(a="world");for(var n=0;n<i.length;n++)"local"===a?(i[n].quaternion.copy(i[n]._quaternionStart),i[n].quaternion.multiply(w)):(i[n].quaternion.copy(v),i[n].quaternion.multiply(i[n]._quaternionStart)),t&&E.snapAngle&&(e=E.snapAngle/180*Math.PI)}function h(){for(var t=E.selection.objects,e=0;e<t.length;e++)delete t[e]._positionStart,delete t[e]._quaternionStart,delete t[e]._scaleStart}function p(t){t&&(i(),E.target.updateMatrixWorld(),y=E.target.matrixWorld.clone(),g.extractRotation(y),x.setFromMatrixPosition(y),T.copy(t).sub(x),A.copy(T),A.applyMatrix4(q.getInverse(g)),E.dispatchEvent({type:"transformstart"}))}function m(t,e){if(t){var i,a=E.axis;b.copy(t).sub(x),f.subVectors(b,T),M.copy(b),M.applyMatrix4(q.getInverse(g)),V.subVectors(M,A),R.copy(b).cross(T),k.copy(M).cross(A),"translate"===E.mode?(-1===a.search("X")&&(f.x=0,V.x=0),-1===a.search("Y")&&(f.y=0,V.y=0),-1===a.search("Z")&&(f.z=0,V.z=0),o(e)):"scale"===E.mode?("XYZ"===a?H.set(f.y/50,f.y/50,f.y/50).addScalar(1):H.set("X"===a?V.x/50:0,"Y"===a?V.y/50:0,"Z"===a?V.z/50:0).addScalar(1),n()):"rotate"===E.mode&&("E"===a?(k.applyMatrix4(g).normalize(),i=k.dot(E.eye)<0?1:-1,v.setFromAxisAngle(E.eye,M.angleTo(A)*i)):"XYZE"===a?(z.copy(f).cross(E.eye).normalize(),v.setFromAxisAngle(z,-.04*f.length())):"X"===a?(w.setFromAxisAngle(s,M.angleTo(A)*(k.x>0?-1:1)),v.setFromAxisAngle(s,b.angleTo(T)*(R.x>0?-1:1))):"Y"===a?(w.setFromAxisAngle(r,M.angleTo(A)*(k.y>0?-1:1)),v.setFromAxisAngle(r,b.angleTo(T)*(R.y>0?-1:1))):"Z"===a&&(w.setFromAxisAngle(l,M.angleTo(A)*(k.z>0?-1:1)),v.setFromAxisAngle(l,b.angleTo(T)*(R.z>0?-1:1))),c(e)),E.dispatchEvent({type:"transform"}),E.dispatchEvent({type:"render",bubble:!0})}}function d(){h(),E.selection.update(),E.dispatchEvent({type:"transformend"}),E.dispatchEvent({type:"render",renderAll:!0,bubble:!0})}REE.Control.call(this,t),this.registerProperties({target:{type:THREE.Object3D,notify:!0},mode:{value:"translate",observer:"modeChanged"},size:{value:1,type:Number,notify:!0},axis:{value:"",type:String,observer:"axisChanged",notify:!0},space:{value:"local",type:String,notify:!0}}),this.helper.add(this.plane),this.helper.visible=!1,this.gnomon=new THREE.Object3D,this.helper.add(this.gnomon),this.helper.update=function(t){this.updateTransform(t),this.updateVisibility(),this.updatePlaneOrientation()}.bind(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.gnomon.add(this.handles),this.gnomon.add(this.pickers),this._handleModes={translate:this.makeGizmoTranslate(),rotate:this.makeGizmoRotate(),scale:this.makeGizmoScale()},this._pickerModes={translate:this.makePickerTranslate(),rotate:this.makePickerRotate(),scale:this.makePickerScale()},this.position=new THREE.Vector3,this.scale=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.eye=new THREE.Vector3,this.alignVector=new THREE.Vector3,this.addEventListener("selection.selection-changed",this.setTargetFromSelection.bind(this)),this.setTargetFromSelection();var u,E=this,y=new THREE.Matrix4,g=new THREE.Matrix4,x=new THREE.Vector3,b=new THREE.Vector3,T=new THREE.Vector3,f=new THREE.Vector3,R=new THREE.Vector3,v=new THREE.Quaternion,M=new THREE.Vector3,A=new THREE.Vector3,V=new THREE.Vector3,k=new THREE.Vector3,w=new THREE.Quaternion,H=new THREE.Vector3,q=new THREE.Matrix4,z=new THREE.Vector3;this.onHover=function(t,e){E.setAxis(e[0])},this.onTrackstart=function(t,e){E.target&&(E.setAxis(e[0]),E.updatePlaneOrientation(),u=E.getPointOnPlane(e[0]),E.active=""!==E.axis,p(u,t.shiftKey))},this.onTrack=function(t,e){E.target&&(E.updatePlaneOrientation(),u=E.getPointOnPlane(e[0]),u&&E.axis&&m(u,t.shiftKey))},this.onTrackend=function(){E.axis="",E.active=!1,d()},this.onKeyup=function(t,e){switch(e){case 87:E.mode="translate";break;case 69:E.mode="rotate";break;case 82:E.mode="scale";break;case 81:E.space="local"===E.space?"world":"local"}"scale"===E.mode&&(E.space="local")}},REE.TransformControl.prototype=Object.create(REE.Control.prototype),REE.TransformControl.prototype.constructor=REE.TransformControl,REE.TransformControl.prototype.updateTransform=function(e){this.target&&(e=e||this.camera,e.updateMatrixWorld(),this.target.updateMatrixWorld(),this.position.setFromMatrixPosition(this.target.matrixWorld),this.scale.setFromMatrixScale(this.target.matrixWorld),this.quaternion.set(0,0,0,1),"local"===this.space&&(n.extractRotation(this.target.matrixWorld),this.quaternion.setFromRotationMatrix(n)),e instanceof THREE.OrthographicCamera?(t=(e.top-e.bottom)/3*this.size,this.eye.copy(l).applyMatrix4(n.extractRotation(e.matrixWorld)).normalize()):(o.setFromMatrixPosition(e.matrixWorld).sub(this.position),t=o.length()/6*this.size,this.eye.copy(o).normalize()),this.helper.position.copy(this.position),this.helper.scale.set(t,t,t),this.alignVector.copy(this.eye).applyQuaternion(a.copy(this.quaternion).inverse()),this.gnomon.traverse(function(t){-1!==t.name.search("E")?(n.lookAt(this.eye,c,r),t.quaternion.setFromRotationMatrix(n)):""!==t.name&&t.quaternion.copy(this.quaternion),"rotate"===this.mode&&("X"===t.name&&(a.setFromAxisAngle(s,Math.atan2(-this.alignVector.y,this.alignVector.z)),a.multiplyQuaternions(this.quaternion,a),t.quaternion.copy(a)),"Y"===t.name&&(a.setFromAxisAngle(r,Math.atan2(this.alignVector.x,this.alignVector.z)),a.multiplyQuaternions(this.quaternion,a),t.quaternion.copy(a)),"Z"===t.name&&(a.setFromAxisAngle(l,Math.atan2(this.alignVector.y,this.alignVector.x)),a.multiplyQuaternions(this.quaternion,a),t.quaternion.copy(a)))}.bind(this)),this.helper.updateMatrixWorld())},REE.TransformControl.prototype.updateVisibility=function(){return this.target&&this.enabled?(this.helper.visible=!0,void this.gnomon.traverse(function(t){t.visible=!0,"translate"===this.mode||"scale"===this.mode?Math.abs(this.alignVector.x)>.99?("X"===t.name||"XY"===t.name||"XZ"===t.name)&&(t.visible=!1):Math.abs(this.alignVector.y)>.99?("Y"===t.name||"XY"===t.name||"YZ"===t.name)&&(t.visible=!1):Math.abs(this.alignVector.z)>.99&&("Z"===t.name||"XZ"===t.name||"YZ"===t.name)&&(t.visible=!1):"rotate"===this.mode&&(Math.abs(this.alignVector.x)<.1&&"X"===t.name&&(t.visible=!1),Math.abs(this.alignVector.y)<.1&&"Y"===t.name&&(t.visible=!1),Math.abs(this.alignVector.z)<.1&&"Z"===t.name&&(t.visible=!1))}.bind(this))):void(this.helper.visible=!1)},REE.TransformControl.prototype.updatePlaneOrientation=function(){""!==this.axis&&("X"===this.axis&&this.plane.lookAt(s),"Y"===this.axis&&this.plane.lookAt(r),"Z"===this.axis&&this.plane.lookAt(l),"XY"===this.axis&&this.plane.lookAt(l),"YZ"===this.axis&&this.plane.lookAt(s),"XZ"===this.axis&&this.plane.lookAt(r),"XYZ"===this.axis&&this.plane.lookAt(this.eye),("translate"===this.mode||"scale"===this.mode)&&("X"===this.axis&&(this.plane.lookAt(r),Math.abs(this.alignVector.z)>Math.abs(this.alignVector.y)&&this.plane.lookAt(l)),"Y"===this.axis&&(this.plane.lookAt(l),Math.abs(this.alignVector.x)>Math.abs(this.alignVector.z)&&this.plane.lookAt(s)),"Z"===this.axis&&(this.plane.lookAt(r),Math.abs(this.alignVector.x)>Math.abs(this.alignVector.y)&&this.plane.lookAt(s))),"E"===this.axis||"rotate"===this.mode?this.plane.lookAt(this.eye):"local"===this.space&&(a.copy(this.plane.quaternion),this.plane.quaternion.copy(this.quaternion).multiply(a)),this.plane.updateMatrixWorld())},REE.TransformControl.prototype.axisChanged=function(){this.handles.traverse(function(t){t.material&&(t.material.oldColor=t.material.oldColor||t.material.color.clone(),t.material.oldOpacity=t.material.oldOpacity||t.material.opacity,t.name===this.axis?(t.material.color.setRGB(1,1,0),t.material.opacity=1):(t.material.color.copy(t.material.oldColor),t.material.opacity=t.material.oldOpacity))}.bind(this))},REE.TransformControl.prototype.modeChanged=function(){for(var t=this.gnomon.children.length;t--;)this.gnomon.remove(this.gnomon.children[t]);this.mode&&(this.handles=this._handleModes[this.mode],this.pickers=this._pickerModes[this.mode],this.gnomon.add(this.handles),this.gnomon.add(this.pickers),this.gnomon.add(this.plane),this.dispatchEvent({type:"render",renderAll:!0,bubble:!0}))},REE.TransformControl.prototype.setAxis=function(t){this.helper.update(this.camera),h.setFromCamera(t.position,this.camera),i=h.intersectObjects([this.pickers],!0)[0],i&&i.object.name?i.object.name!==this.axis&&(this.axis=i.object.name):this.axis="",this.dispatchEvent({type:"render",bubble:!0})},REE.TransformControl.prototype.getPointOnPlane=function(t){return h.setFromCamera(t.position,this.camera),i=h.intersectObjects([this.plane])[0],i?i.point:void 0},REE.TransformControl.prototype.setTargetFromSelection=function(){this.selection.objects.length?this.target=this.selection.objects[this.selection.objects.length-1]:this.target=void 0}}();
!function(){"use strict";var e=new THREE.MeshBasicMaterial;e.depthTest=!1,e.depthWrite=!1,e.transparent=!0,e.side=THREE.FrontSide;var t=new THREE.LineBasicMaterial;t.depthTest=!1,t.depthWrite=!1,t.transparent=!0;var n=e.clone();n.visible=!1,n.transparent=!1,n.opacity=.5;var r=e.clone();r.color.set(16711680);var E=e.clone();E.color.set(65280);var o=e.clone();o.color.set(255);var a=e.clone();a.opacity=.25;var T=a.clone();T.color.set(16776960);var s=a.clone();s.color.set(65535);var R=a.clone();R.color.set(16711935);var i=e.clone();i.color.set(16776960);var w=t.clone();w.color.set(16711680);var H=t.clone();H.color.set(65280);var h=t.clone();h.color.set(255);var M=t.clone();M.color.set(16776960);var l=t.clone();l.color.set(7895160);var c=M.clone();c.opacity=.25;var m=new THREE.Geometry,y=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,!1));y.position.y=.5,y.updateMatrix(),m.merge(y.geometry,y.matrix);var u=new THREE.Geometry,p=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125));p.position.y=.5,p.updateMatrix(),u.merge(p.geometry,p.matrix);var f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3));var P=new THREE.BufferGeometry;P.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var v=new THREE.BufferGeometry;v.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3));var G=function(e,t,n){var r=new THREE.BufferGeometry,E=[];n=n?n:1;for(var o=0;64*n>=o;++o)"x"===t&&E.push(0,Math.cos(o/32*Math.PI)*e,Math.sin(o/32*Math.PI)*e),"y"===t&&E.push(Math.cos(o/32*Math.PI)*e,0,Math.sin(o/32*Math.PI)*e),"z"===t&&E.push(Math.sin(o/32*Math.PI)*e,Math.cos(o/32*Math.PI)*e,0);return r.addAttribute("position",new THREE.Float32Attribute(E,3)),r},d={X:[[new THREE.Mesh(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,w)]],Y:[[new THREE.Mesh(m,E),[0,.5,0]],[new THREE.Line(P,H)]],Z:[[new THREE.Mesh(m,o),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(v,h)]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),a),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),T),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),R),[.15,0,.15],[-Math.PI/2,0,0]]]},I={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),n)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),n),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},X={X:[[new THREE.Line(new G(1,"x",.5),w)]],Y:[[new THREE.Line(new G(1,"y",.5),H)]],Z:[[new THREE.Line(new G(1,"z",.5),h)]],E:[[new THREE.Line(new G(1.25,"z",1),c)]],XYZE:[[new THREE.Line(new G(1,"z",1),l)]]},Y={X:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),n)]],XYZE:[[new THREE.Mesh(new THREE.SphereGeometry(.95,8,8),n)]]},Z={X:[[new THREE.Mesh(u,r),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,w)]],Y:[[new THREE.Mesh(u,E),[0,.5,0]],[new THREE.Line(P,H)]],Z:[[new THREE.Mesh(u,o),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(v,h)]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),a)]]},B={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),n)]]},C=function(e){var t=new THREE.Object3D;for(var n in e){var r=new THREE.Object3D;t.add(r),t[n]=r;for(var E=e[n].length;E--;){var o=e[n][E][0].clone(),a=e[n][E][1],T=e[n][E][2];o.name=n,a&&o.position.set(a[0],a[1],a[2]),T&&o.rotation.set(T[0],T[1],T[2]),o.updateMatrix();var s=o.geometry.clone();s.applyMatrix(o.matrix),o.geometry=s,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),r.add(o)}}return t};REE.TransformControl.prototype.makeGizmoTranslate=function(){return C(d)},REE.TransformControl.prototype.makeGizmoRotate=function(){return C(X)},REE.TransformControl.prototype.makeGizmoScale=function(){return C(Z)},REE.TransformControl.prototype.makePickerTranslate=function(){return C(I)},REE.TransformControl.prototype.makePickerRotate=function(){return C(Y)},REE.TransformControl.prototype.makePickerScale=function(){return C(B)}}();