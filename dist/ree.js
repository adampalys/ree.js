var REE={};REE.Revision="0.0.1",function(){"use strict";REE.Register=function(t){var e=t.properties||{},E=t.is;REE[E]=function(t){REE.Element.call(this,t);for(var E in e)this.registerProperty(E,e[E],t[E])},REE[E].prototype=Object.create(REE.Element.prototype),REE[E].prototype.constructor=REE[E],Object.defineProperty(REE[E],"name",{value:E}),REE[E].prototype.toString=function(){return"REE."+E};for(var r in t)"function"==typeof t[r]&&(REE[E].prototype[r]=t[r])}}();
!function(){"use strict";REE.Property=function(e,t,i){this.key=t,this.parent=e,this["default"]=i.value,this.type=i.type,this.observer=void 0,this.notify=!1,this.writable=!0,this.persist=!1,this.enumerable=!0,this._path=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),i&&this.define(i)},REE.Property.prototype.define=function(e){void 0!==e.value&&(this["default"]=e.value),void 0!==e.type&&(this.type=e.type),void 0!==e.observer&&(this.observer=e.observer),void 0!==e.notify&&(this.notify=e.notify),void 0!==e.writable&&(this.writable=e.writable),void 0!==e.persist&&(this.persist=e.persist),void 0!==e.enumerable&&(this.enumerable=e.enumerable)},REE.Property.prototype.setValue=function(e){if(this.writable===!1&&void 0!==this.value)return void console.warn("REE.Element: "+this.key+" is read only.");if(this.type&&void 0!==e)if(this.type===String){if("string"!=typeof e)return void console.warn("REE.Element: "+this.key+" is incorrect type.")}else if(this.type===Boolean){if("boolean"!=typeof e)return void console.warn("REE.Element: "+this.key+" is incorrect type.")}else if(this.type===Number){if("number"!=typeof e)return void console.warn("REE.Element: "+this.key+" is incorrect type.")}else if("function"==typeof this.type&&!(e instanceof this.type))return void console.warn("REE.Element: "+this.key+" is incorrect type.");this.value=e,this.persist===!0&&this.setPersistedValue()},REE.Property.prototype.setPersistedValue=function(){localStorage.setItem(this.parent.uuid+"_"+this.key,JSON.stringify(this.value))},REE.Property.prototype.getPersistedValue=function(){var e=localStorage.getItem(this.parent.uuid+"_"+this.key),t=this.type;if(null!==e){if(t===Number||t===String||t===Boolean)e=JSON.parse(e);else if("function"==typeof t){var i=JSON.parse(e);e=new t;for(var r in i)e[r]=i[r]}return e}return this["default"]}}();
!function(){"use strict";REE.Element=function(e){Object.defineProperties(this,{_config:{value:e||{}},_properties:{value:{}},_bindings:{value:{}},_debouncers:{value:{}},_listeners:{value:{}},_parents:{value:[]},_children:{value:{}},_ready:{value:!1,writable:!0}}),this.registerProperties({uuid:{value:THREE.Math.generateUUID(),type:String,observer:"_uuidChanged"}}),setTimeout(function(){this.ready&&this.ready(),this._ready=!0}.bind(this))},REE.Element.prototype.registerProperty=function(e,t,i){void 0===this._properties[e]?this._properties[e]=new REE.Property(this,e,t):this._properties[e].define(t);var s=this._properties[e];i instanceof Array&&i[0]instanceof REE.Element&&"string"==typeof i[1]?i[0]._ready?s["default"]=i[0][i[1]]:s["default"]=i[0]._config[i[1]]:i&&(s["default"]=i);var r;if(!this.hasOwnProperty(e)){var n={key:e,element:this};Object.defineProperty(this,e,{get:function(){return s.value},set:function(t){s.value!==t&&(r=s.value,s.setValue(t),r instanceof REE.Element&&(r._parents.splice(r._parents.indexOf(n),1),delete this._children[e]),t instanceof REE.Element&&(t._parents.push(n),this._children[e]=t),void 0!==s.observer&&(this._ready?this[s.observer].call(this,{value:t,oldValue:r}):this.debounce(s._path+"-init",function(){this[s.observer].call(this,{value:t,oldValue:r})}.bind(this))),s.notify===!0&&this.dispatchEvent({type:s._path+"-changed",key:e,value:t,oldValue:r}))},enumerable:s.enumerable})}i instanceof Array&&i[0]instanceof REE.Element&&"string"==typeof i[1]&&(i[0]._ready?i[0].bindProperty(i[1],this,e):this.debounce("bind-property"+e,function(){i[0].bindProperty(i[1],this,e)}.bind(this))),s.persist?this[e]=s.getPersistedValue():this[e]=s["default"]},REE.Element.prototype.registerProperties=function(e){for(var t in e){var i=e[t],s=this._config[t];this.registerProperty(t,i,s)}},REE.Element.prototype.bindProperty=function(e,t,i){t instanceof HTMLElement&&(t._properties=t._properties||{},t._properties[i]=new REE.Property(t,i,{}));var s=this,r=this._properties[e]._path;this._properties[e].notify=!0,t._properties[i].notify=!0,this._bindings[r]={source:s,target:t,sourcePath:s._properties[e]._path,targetPath:t._properties[i]._path,sourceObserver:function(){t[i]=s[e]},targetObserver:function(){s[e]=t[i]}},s.addEventListener(this._bindings[r].sourcePath+"-changed",this._bindings[r].sourceObserver),t.addEventListener(this._bindings[r].targetPath+"-changed",this._bindings[r].targetObserver),void 0!==s[e]?t[i]=s[e]:void 0!==t[i]&&(s[e]=t[i])},REE.Element.prototype.addEventListener=function(e,t){void 0===this._listeners[e]&&(this._listeners[e]=[],this._listeners[e].regExp=new RegExp("^"+e.replace(/[*]/g,".*").toLowerCase().trim()+"$")),-1===this._listeners[e].indexOf(t)&&this._listeners[e].push(t)},REE.Element.prototype.removeEventListener=function(e,t){if(void 0!==this._listeners[e]){var i=this._listeners[e].indexOf(t);if(-1!==i)return void this._listeners[e].splice(i,1)}console.warn("REE.Element: Could not find listener",e)},REE.Element.prototype.removeEventListeners=function(e){if("string"==typeof e&&void 0!==this._listeners[e]&&(this._listeners[e].length=0),"function"==typeof e)for(var t in this._listeners){var i=this._listeners[t].indexOf(e);-1!==i&&this._listeners[t].splice(i,1)}},REE.Element.prototype.dispatchEvent=function(e){var t=e.type,i=[];for(var s in this._listeners)this._listeners[s].regExp.test(t)&&(i=i.concat(this._listeners[s]));if(e.target=e.target||this,void 0!==i)for(var r=0;r<i.length;r++)i[r].call(this,e);if(e.bubble===!0)for(var n=0;n<this._parents.length;n++)e.type=this._parents[n].key+"."+t,this._parents[n].element.dispatchEvent(e)},REE.Element.prototype.debounce=function(e,t,i){window.clearTimeout(this._debouncers[e]),this._debouncers[e]=setTimeout(function(){t(),delete this._debouncers[e]}.bind(this),i)},REE.Element.prototype._uuidChanged=function(e){if(e.oldValue)for(var t in this._properties)this._properties[t].persist&&(this[t]=this._properties[t].getPersistedValue())},REE.Element.prototype.dispose=function(){for(var e in this._config)delete this._config[e];for(e in this._properties)delete this._properties[e];for(e in this._bindings)this._bindings[e].source.removeEventListener(this._bindings[e].sourcePath+"-changed",this._bindings[e].sourceObserver),this._bindings[e].target.removeEventListener(this._bindings[e].targetPath+"-changed",this._bindings[e].targetObserver),delete this._bindings[e];for(e in this._debouncers)window.clearTimeout(this._debouncers[e]),delete this._debouncers[e];for(e in this._listeners){for(var t=this._listeners[e].length;t--;)this.removeEventListener(e,this._listeners[e][t]);delete this._listeners[e]}this._parents.length=0;for(e in this._children)delete this._children[e]}}();
!function(){REE.Helper=function(e){THREE.Object3D.call(this),REE.Element.call(this,e)},REE.Helper.prototype=Object.create(THREE.Object3D.prototype),REE.Helper.prototype.constructor=REE.Helper,REE.Helper.prototype.registerProperty=REE.Element.prototype.registerProperty,REE.Helper.prototype.registerProperties=REE.Element.prototype.registerProperties,REE.Helper.prototype.bindProperty=REE.Element.prototype.bindProperty,REE.Helper.prototype.dispose=REE.Element.prototype.dispose,REE.Helper.prototype.debounce=REE.Element.prototype.debounce,REE.Helper.prototype.addEventListener=REE.Element.prototype.addEventListener,REE.Helper.prototype.removeEventListener=REE.Element.prototype.removeEventListener,REE.Helper.prototype.dispatchEvent=REE.Element.prototype.dispatchEvent,REE.Helper.prototype._setPersistedValue=REE.Element.prototype._setPersistedValue,REE.Helper.prototype._getPersistedValue=REE.Element.prototype._getPersistedValue,REE.Helper.prototype._uuidChanged=REE.Element.prototype._uuidChanged,REE.Helper.prototype.update=function(){}}();
!function(){var t=new THREE.Matrix4,i=new THREE.Vector3;REE.CompassHelper=function(t){REE.Helper.call(this,t),this.registerProperties({axis:{value:new THREE.AxisHelper(1),type:THREE.AxisHelper,writable:!1},visible:{value:!0,type:Boolean},size:{value:.25,type:Number}}),this.axis.matrixAutoUpdate=!1,this.axis.material.linewidth=2,this.axis.material.depthTest=!1,this.axis.frustumCulled=!1,this.matrixAutoUpdate=!1,this.add(this.axis)},REE.CompassHelper.prototype=Object.create(REE.Helper.prototype),REE.CompassHelper.prototype.constructor=REE.CompassHelper,REE.CompassHelper.prototype.update=function(e){if(e){this.matrix.identity(),t.identity(),this.matrix.multiply(e.matrixWorld),t.identity(),this.axis.matrix.identity(),this.axis.matrix.multiply(t.getInverse(t.extractRotation(e.matrixWorld))),t.identity(),t.makeTranslation(0,0,0),this.axis.matrix.multiply(t),t.identity(),this.matrix.multiply(t.getInverse(e.projectionMatrix)),i.set(1,1,1).applyProjection(e.projectionMatrix);var a=this.size*i.x/i.y,s=this.size;t.identity(),t.makeTranslation(1-a,1-s,0),this.matrix.multiply(t),t.identity(),t.makeScale(a,s,1),this.matrix.multiply(t)}}}();
!function(){"use strict";var i=new THREE.Vector3,t=new THREE.Vector3,e=new THREE.Matrix4,r=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),o=new THREE.Vector3(0,0,1);REE.GridHelper=function(i){REE.Helper.call(this,i),this.registerProperties({showAxis:{value:!0,type:Boolean},axisSize:{value:10,type:Number},showGrid:{value:!0,type:Boolean},gridSize:{value:10,type:Number,observer:"updateGrid"},gridWidth:{value:10,type:Number,observer:"updateGrid"},gridColor1:{value:"white",type:String,observer:"updateGrid"},gridColor2:{value:"#222",type:String,observer:"updateGrid"}}),this._grid=new THREE.GridHelper(this.gridSize*this.gridWidth,this.gridSize),this._grid.setColors(this.gridColor1,this.gridColor2),this._grid.material.transparent=!0,this._grid.material.opacity=.5,this._grid.material.depthWrite=!1,this.add(this._grid),this._axis=new THREE.AxisHelper,this._axis.material.depthTest=!1,this.add(this._axis),this.update()},REE.GridHelper.prototype=Object.create(REE.Helper.prototype),REE.GridHelper.prototype.constructor=REE.GridHelper,REE.GridHelper.prototype.updateGrid=function(){var i=new THREE.GridHelper(this.gridSize*this.gridWidth,this.gridSize);i.setColors(this.gridColor1,this.gridColor2),this._grid.geometry=i.geometry},REE.GridHelper.prototype.update=function(d){this._grid.visible=this.showGrid===!0,this._axis.visible=this.showAxis===!0,this._axis.scale.set(this.axisSize,this.axisSize,this.axisSize),d&&(e.extractRotation(d.matrixWorld.clone()),i.copy(o.multiplyScalar(1)).applyMatrix4(e),t.set(i.dot(r),i.dot(s),i.dot(o)),d instanceof THREE.PerspectiveCamera?t.treshold=.999:t.treshold=.7071,Math.abs(t.z)>t.treshold?this._grid.rotation.set(Math.PI/2,0,0):Math.abs(t.x)>t.treshold?this._grid.rotation.set(0,0,Math.PI/2):this._grid.rotation.set(0,0,0))}}();
!function(){REE.BoxHelper=function(e){REE.Helper.call(this,e),Object.defineProperties(this,{_bboxHelper:{value:new THREE.BoxHelper(new THREE.Mesh(new THREE.BoxGeometry(1,1,1,1,1,1)))}}),this._bboxHelper.material.depthTest=!1,this.add(this._bboxHelper)},REE.BoxHelper.prototype=Object.create(REE.Helper.prototype),REE.BoxHelper.prototype.constructor=REE.BoxHelper}();
!function(){REE.PlaneHelper=function(e){REE.Helper.call(this,e),Object.defineProperties(this,{_planeHelper:{value:new THREE.Mesh(new THREE.PlaneBufferGeometry(1e6,1e6,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,depthTest:!1}))}}),this._planeHelper.rotation.set(Math.PI/2,0,0),this._planeHelper.updateMatrixWorld(),this.add(this._planeHelper)},REE.PlaneHelper.prototype=Object.create(REE.Helper.prototype),REE.PlaneHelper.prototype.constructor=REE.PlaneHelper,REE.PlaneHelper.prototype.lookAt=function(e){this._planeHelper.lookAt(e)}}();
!function(){REE.SceneState=function(e){THREE.Scene.call(this),REE.Element.call(this,e),this.registerProperties({_helpers:{value:new THREE.Scene,type:THREE.Scene,writable:!1}})},REE.SceneState.prototype=Object.create(THREE.Scene.prototype),REE.SceneState.prototype.constructor=REE.SceneState,REE.SceneState.prototype.registerProperty=REE.Element.prototype.registerProperty,REE.SceneState.prototype.registerProperties=REE.Element.prototype.registerProperties,REE.SceneState.prototype.bindProperty=REE.Element.prototype.bindProperty,REE.SceneState.prototype.dispose=REE.Element.prototype.dispose,REE.SceneState.prototype.debounce=REE.Element.prototype.debounce,REE.SceneState.prototype.addEventListener=REE.Element.prototype.addEventListener,REE.SceneState.prototype.removeEventListener=REE.Element.prototype.removeEventListener,REE.SceneState.prototype.dispatchEvent=REE.Element.prototype.dispatchEvent,REE.SceneState.prototype._setPersistedValue=REE.Element.prototype._setPersistedValue,REE.SceneState.prototype._getPersistedValue=REE.Element.prototype._getPersistedValue,REE.SceneState.prototype._uuidChanged=REE.Element.prototype._uuidChanged}();
!function(){"use strict";var t={persp:new THREE.PerspectiveCamera(30,1,.1,1e4),top:new THREE.OrthographicCamera(25,-25,25,-25,-1e3,1e3),bottom:new THREE.OrthographicCamera(25,-25,25,-25,-1e3,1e3),front:new THREE.OrthographicCamera(25,-25,25,-25,-1e3,1e3),back:new THREE.OrthographicCamera(25,-25,25,-25,-1e3,1e3),left:new THREE.OrthographicCamera(25,-25,25,-25,-1e3,1e3),right:new THREE.OrthographicCamera(25,-25,25,-25,-1e3,1e3)};t.persp.position.set(300,300,300),t.persp.lookAt(new THREE.Vector3),t.top.rotation.set(-Math.PI/2,0,-Math.PI/2),t.top.position.set(0,100,0),t.bottom.rotation.set(Math.PI/2,0,-Math.PI/2),t.bottom.position.set(0,-100,0),t.front.position.set(0,0,100),t.back.rotation.set(0,Math.PI,0),t.back.position.set(0,0,-100),t.left.rotation.set(0,Math.PI/2,0),t.left.position.set(100,0,0),t.right.rotation.set(0,-Math.PI/2,0),t.right.position.set(-100,0,0);for(var e=0;e<t.length;e++)t[e]._target=new THREE.Vector3;var a=[{label:"persp",value:t.persp},{label:"top",value:t.top},{label:"bottom",value:t.bottom},{label:"front",value:t.front},{label:"back",value:t.back},{label:"left",value:t.left},{label:"right",value:t.right}];REE.CamerasState=function(e){REE.Element.call(this,e),this.registerProperties({persp:{value:t.persp,type:THREE.Camera},top:{value:t.top,type:THREE.Camera},bottom:{value:t.bottom,type:THREE.Camera},front:{value:t.front,type:THREE.Camera},back:{value:t.back,type:THREE.Camera},right:{value:t.right,type:THREE.Camera},left:{value:t.left,type:THREE.Camera},options:{value:a,type:Array}})},REE.CamerasState.prototype=Object.create(REE.Element.prototype),REE.CamerasState.prototype.constructor=REE.CamerasState,REE.CamerasState.prototype.update=function(){}}();
!function(){"use strict";REE.Register({is:"ConfigState",properties:{clearColor:{value:"#222222",type:String,notify:!0,persist:!0},showHelpers:{value:!0,type:Boolean,notify:!0,persist:!0},showAxis:{value:!0,type:Boolean,notify:!0,persist:!0},axisSize:{value:10,type:Number,notify:!0,persist:!0},showGrid:{value:!0,type:Boolean,notify:!0,persist:!0},gridSize:{value:10,type:Number,notify:!0,persist:!0},gridWidth:{value:10,type:Number,notify:!0,persist:!0},gridColor1:{value:"white",type:String,notify:!0,persist:!0},gridColor2:{value:"#222",type:String,notify:!0,persist:!0},snapAngle:{value:45,type:Number,notify:!0,persist:!0},showCompass:{value:!0,type:Boolean,notify:!0,persist:!0},compassSize:{value:.125,type:Number,notify:!0,persist:!0}},ready:function(){console.log(""+this,"ready")}})}();
!function(){"use strict";REE.ControlsState=function(t){REE.Element.call(this,t),Object.defineProperties(this,{_name:{value:"",writable:!0}}),this.registerProperties({scene:{type:REE.SceneState},selectionControl:{value:new REE.SelectionControl({scene:[this,"scene"]}).begin(),type:REE.SelectionControl,writable:!1},viewportControl:{value:new REE.ViewportControl,type:REE.ViewportControl,writable:!1},control:{type:REE.Control,notify:!0},selector:{value:"transform:translate",type:String,observer:"_selectorChanged",notify:!0},mode:{type:String,observer:"_modeChanged",notify:!0},snapDistance:{type:Number},snapAngle:{type:Number}})},REE.ControlsState.prototype=Object.create(REE.Element.prototype),REE.ControlsState.prototype.constructor=REE.ControlsState,REE.ControlsState.prototype._selectorChanged=function(){var t=this.selector.split(":")[0],e=this.selector.split(":")[1]||"";if(this._name!==t){if(this.control&&this.control.dispose(),t){var o=t.charAt(0).toUpperCase()+t.slice(1)+"Control";this.mode=e,this.control=new REE[o],this.bindProperty("scene",this.control,"scene"),this.bindProperty("mode",this.control,"mode"),this.bindProperty("snapDistance",this.control,"snapDistance"),this.bindProperty("snapAngle",this.control,"snapAngle"),this.control.addEventListener("cancel",function(){this.selector=""}.bind(this)),this.control.addEventListener("end",function(){this.selector=""}.bind(this)),this.control.addEventListener("active-changed",function(){this.control.active?(this.viewportControl.enabled=!1,this.selectionControl.enabled=!1,this.selectionControl.helper.visible=!1):(this.viewportControl.enabled=!0,this.selectionControl.enabled=!0,this.selectionControl.helper.visible=!0)}.bind(this)),this.control.begin()}this._name=t}this.mode=e},REE.ControlsState.prototype._modeChanged=function(){this.debounce("mode-changed",function(){this.mode?this.selector=this._name+":"+this.mode:this.selector=this._name}.bind(this))}}();
!function(){var t,e=new THREE.Box3;REE.SelectionState=function(t){REE.Element.call(this,t),this.registerProperties({objects:{value:[],type:Array,writable:!1},center:{value:new THREE.Vector3,type:THREE.Vector3,writable:!1},box:{value:new THREE.Box3,type:THREE.Box3,writable:!1},sphere:{value:new THREE.Sphere,type:THREE.Sphere,writable:!1}})},REE.SelectionState.prototype=Object.create(REE.Element.prototype),REE.SelectionState.prototype.constructor=REE.SelectionState,REE.SelectionState.prototype.clear=function(){this.remove([].concat(this.objects)),this.update()},REE.SelectionState.prototype.add=function(t){t instanceof THREE.Object3D&&(t=[t]);for(var e=0;e<t.length;e++)-1===this.objects.indexOf(t[e])&&this.objects.push(t[e]);this.update()},REE.SelectionState.prototype.remove=function(t){t instanceof THREE.Object3D&&(t=[t]);for(var e=t.length;e--;)-1!==this.objects.indexOf(t[e])&&this.objects.splice(this.objects.indexOf(t[e]),1);this.update()},REE.SelectionState.prototype.toggle=function(t){t instanceof THREE.Object3D&&(t=[t]);for(var e=t.length;e--;)-1!==this.objects.indexOf(t[e])?this.objects.splice(this.objects.indexOf(t[e]),1):this.objects.push(t[e]);this.update()},REE.SelectionState.prototype.selectParents=function(){for(var t=[],e=0;e<this.objects.length;e++)this.objects[e].parent&&t.push(this.objects[e].parent);this.clear(),this.add(t)},REE.SelectionState.prototype.selectChildren=function(){for(var t=[],e=0;e<this.objects.length;e++)this.objects[e].children.length&&t.push(this.objects[e].children[0]);this.clear(),this.add(t)},REE.SelectionState.prototype.selectNext=function(){for(var t=[],e=0;e<this.objects.length;e++)if(this.objects[e].parent){var i=this.objects[e].parent.children.indexOf(this.objects[e]);i=(i+1)%this.objects[e].parent.children.length,t.push(this.objects[e].parent.children[i])}this.clear(),this.add(t)},REE.SelectionState.prototype.selectPrevious=function(){for(var t=[],e=0;e<this.objects.length;e++)if(this.objects[e].parent){var i=this.objects[e].parent.children.indexOf(this.objects[e]);i=(this.objects[e].parent.children.length+i-1)%this.objects[e].parent.children.length,t.push(this.objects[e].parent.children[i])}this.clear(),this.add(t)},REE.SelectionState.prototype.update=function(){this.debounce("update",function(){if(this.box.makeEmpty(),this.sphere.empty(),this.center.set(0,0,0),0!==this.objects.length){for(var i=0;i<this.objects.length;i++)t=this.objects[i],e.setFromObject(t),this.box.expandByPoint(e.min),this.box.expandByPoint(e.max);this.center.copy(this.box.min).add(this.box.max).multiplyScalar(.5),this.box.getBoundingSphere(this.sphere)}this.dispatchEvent({type:"selection-changed",bubble:!0,value:this})}.bind(this))}}();
!function(){var e=document.createElement("div");e.className="three-control",e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.bottom=0,e.style.right=0,e.style.zIndex=1e7,e.style.cursor="move";var t,n=new THREE.Raycaster,o=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Matrix4,a=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),p=new THREE.Vector3(0,0,1),c=new REE.SelectionState;REE.Control=function(t){function n(e){D.enabled!==!1&&(k=v(e.path[0]),k&&(D.domElement=e.path[0],D.camera=v(e.path[0]).camera,y=V(e,!0),"function"==typeof D.onTrackstart&&D.onTrackstart(e,y),window.addEventListener("mousemove",o),window.addEventListener("mouseup",i)))}function o(t){return D.enabled===!1?(window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",i),void(e.parentNode===document.body&&document.body.removeChild(e))):(y=V(t),"function"==typeof D.onTrack&&D.onTrack(t,y),void(e.parentNode!==document.body&&document.body.appendChild(e)))}function i(t){window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",i),e.parentNode===document.body&&document.body.removeChild(e),D.enabled!==!1&&(y=V(t),"function"==typeof D.onTrackend&&D.onTrackend(t,y))}function r(e){D.enabled!==!1&&(k=v(e.path[0]),k&&(D.domElement=k.domElement,D.camera=k.camera,y=V(e),"function"==typeof D.onHover&&D.onHover(e,y)))}function a(e){e.preventDefault(),e.path[0].focus(),D.enabled!==!1&&(k=v(e.path[0]),k&&(D.domElement=k.domElement,D.camera=k.camera,H=!0,setTimeout(function(){H=!1}),y=V(e,!0),"function"==typeof D.onHover&&D.onHover(e,y),"function"==typeof D.onTrackstart&&D.onTrackstart(e,y),e.path[0].addEventListener("touchmove",s),e.path[0].addEventListener("touchend",p)))}function s(t){return t.preventDefault(),D.enabled===!1?(t.path[0].removeEventListener("touchmove",s),void t.path[0].removeEventListener("touchend",p)):void(H!==!0&&(y=V(t),"function"==typeof D.onTrack&&D.onTrack(t,y),e.parentNode!==document.body&&document.body.appendChild(e)))}function p(t){t.preventDefault(),t.path[0].removeEventListener("touchmove",s),t.path[0].removeEventListener("touchend",p),e.parentNode===document.body&&document.body.removeChild(e),D.enabled!==!1&&"function"==typeof D.onTrackend&&D.onTrackend(t,y)}function l(e){k=v(e.path[0]),k&&(e.preventDefault(),D.enabled!==!1&&(b=0,e.wheelDelta?b=-e.wheelDelta:e.detail&&(b=10*e.detail),"function"==typeof D.onMousewheel&&D.onMousewheel(e,b)))}function d(e){k=v(e.path[0]),k&&D.enabled!==!1&&(8===e.which&&e.preventDefault(),"function"==typeof D.onKeydown&&D.onKeydown(e,e.which))}function u(e){k=v(e.path[0]),k&&D.enabled!==!1&&("function"==typeof D.onKeyup&&D.onKeyup(e,e.which),27===e.which&&D.cancel())}function h(e){k=v(e.path[0]),k&&(e.preventDefault(),D.enabled!==!1&&"function"==typeof D.onContextmenu&&D.onContextmenu(e))}function v(e){return D._viewports.find(function(t){return t.domElement===e})}REE.Element.call(this,t),Object.defineProperties(this,{helper:{value:new THREE.Object3D,writable:!1,enumerable:!0},plane:{value:new REE.PlaneHelper,writable:!1,enumerable:!0},_viewports:{value:[]}}),this.helper.add(this.plane),this.helper.update=function(){},this.plane.update=this.updatePlane.bind(this),this.registerProperties({camera:{type:THREE.Camera,notify:!0},domElement:{type:HTMLElement,notify:!0},scene:{type:THREE.Scene},selection:{value:c,type:REE.Selection,writable:!1},active:{value:!1,type:Boolean,notify:!0},mode:{value:"",type:String,notify:!0},snapDistance:{value:0,type:Number},snapAngle:{value:0,type:Number},enabled:{value:!0,type:Boolean,notify:!0}});var m,E,f,y,w,b,R,L,T,C,g,k,D=this,H=!1,x=function(e,t){return m=D.domElement.getBoundingClientRect(),new THREE.Vector2((e-m.left)/m.width*2-1,1-(t-m.top)/m.height*2)},M=function(e,t){C=t[0];for(var n=1;n<t.length;n++)t[n].distanceTo(e)<C.distanceTo(e)&&(C=t[n]);return C},V=function(e,t){E=e.touches?e.touches:[e],L=t?[]:w||[],R=t?[]:R||[],w=[],T=[],g=[];for(var n=0;n<E.length;n++)(E[n].target===e.path[0]||void 0===e.touches)&&(f=x(E[n].clientX,E[n].clientY),w.push(f),void 0===L[w.length-1]&&L.push(f.clone()),void 0===R[w.length-1]&&R.push(f.clone()));var o=[];for(n=0;n<w.length;n++)T[n]=w[n].clone().sub(M(w[n],L)),g[n]=w[n].clone().sub(M(w[n],R)),o[n]={position:w[n],previous:L[n],delta:T[n],offset:g[n]};return o};this.registerViewport=function(e,t){k=v(e),k?t&&(k.camera=t):(k={domElement:e,camera:t},D._viewports.push(k),e.addEventListener("mousedown",n),e.addEventListener("touchstart",a),e.addEventListener("mousewheel",l),e.addEventListener("DOMMouseScroll",l),e.addEventListener("mousemove",r),e.addEventListener("keydown",d),e.addEventListener("keyup",u),e.addEventListener("contextmenu",h))},this.unregisterViewport=function(e){k=v(e),k&&(e.removeEventListener("mousedown",n),e.removeEventListener("touchstart",a),e.removeEventListener("mousewheel",l),e.removeEventListener("DOMMouseScroll",l),e.removeEventListener("mousemove",r),e.removeEventListener("keydown",d),e.removeEventListener("keyup",u),e.removeEventListener("contextmenu",h),D._viewports.splice(D._viewports.indexOf(k),1))}},REE.Control.prototype=Object.create(REE.Element.prototype),REE.Control.prototype.constructor=REE.Control,REE.Control.prototype.begin=function(){return this.scene._helpers.add(this.helper),"function"==typeof this.onBegin&&this.onBegin(),this.dispatchEvent({type:"begin"}),this},REE.Control.prototype.cancel=function(){return this.helper.parent&&this.helper.parent.remove(this.helper),"function"==typeof this.onCancel&&this.onCancel(),this.dispatchEvent({type:"cancel"}),this},REE.Control.prototype.end=function(){return this.helper.parent&&this.helper.parent.remove(this.helper),"function"==typeof this.onEnd&&this.onEnd(),this.dispatchEvent({type:"end"}),this},REE.Control.prototype.dispose=function(){REE.Element.prototype.dispose.call(this),this.enabled=!1,this.active=!1;for(var e=this._viewports.length;e--;)this.unregisterViewport(this._viewports[e].domElement);this.helper.parent&&this.helper.parent.remove(this.helper)},REE.Control.prototype.updatePlane=function(e){void 0!==e&&(r.extractRotation(e.matrixWorld.clone()),o.copy(p.multiplyScalar(1)).applyMatrix4(r),i.set(o.dot(a),o.dot(s),o.dot(p)),e instanceof THREE.PerspectiveCamera?i.treshold=.999:i.treshold=.65,Math.abs(i.z)>i.treshold?this.plane.lookAt(p):Math.abs(i.x)>i.treshold?this.plane.lookAt(a):this.plane.lookAt(s),this.plane.updateMatrixWorld())},REE.Control.prototype.getPointOnPlane=function(e,o){return this.plane.update(this.camera),n.setFromCamera(e,this.camera),t=n.intersectObjects([this.plane],!0)[0],t?(o===!0&&this.snapDistance&&(t.point.x=Math.round(t.point.x/this.snapDistance)*this.snapDistance,t.point.y=Math.round(t.point.y/this.snapDistance)*this.snapDistance,t.point.z=Math.round(t.point.z/this.snapDistance)*this.snapDistance),t.point):void 0}}();
!function(){"use strict";REE.LineControl=function(e){function t(e){s.push(e.x),s.push(e.y),s.push(e.z),3===s.length&&(s.push(e.x),s.push(e.y),s.push(e.z)),i()}function n(e){s[s.length-3]=e.x,s[s.length-2]=e.y,s[s.length-1]=e.z,i()}function i(){if(s.length){l.removeAttribute("position"),a=new Uint32Array(s.length/3),l.setIndex(new THREE.BufferAttribute(a,1)),h=new Float32Array(s.length),l.addAttribute("position",new THREE.BufferAttribute(h,3));for(var e=0;e<s.length/3;e++)h[3*e+0]=s[3*e+0],h[3*e+1]=s[3*e+1],h[3*e+2]=s[3*e+2],a[e]=e;l.needsUpdate=!0}}function r(){if(E.parent&&E.parent.remove(E),!(s.length<=6)){s.length=0,l.computeBoundingSphere();var e=new THREE.Line(l.clone(),p.clone());e.name="line",b.scene.add(e),b.selection.clear(),b.selection.add(e)}}function o(){s.length&&s.splice(s.length-3,3),i(),b.dispatchEvent({type:"render",bubble:!0})}REE.Control.call(this,e);var s=[],a=new Uint16Array,h=new Float32Array,l=new THREE.BufferGeometry,u=new THREE.BufferAttribute(a,1),c=new THREE.BufferAttribute(h,3);l.setIndex(u),l.addAttribute("position",c);var p=new THREE.LineBasicMaterial({linewidth:1});p.depthTest=!1;var E=new THREE.Line(l,p);E.frustumCulled=!1;var d,f;this.onTrackstart=function(e,n){e.altKey||(this.helper.add(E),d=this.getPointOnPlane(n[0].position,e.shiftKey),d&&(this.active=!0,t(d),this.dispatchEvent({type:"render",bubble:!0})))},this.onTrack=function(e,t){e.altKey||(f=this.getPointOnPlane(t[0].position,e.shiftKey),f&&s.length>=6&&(n(f),this.dispatchEvent({type:"render",bubble:!0})))},this.onTrackend=function(e){e.altKey||(this.active=!1,this.dispatchEvent({type:"render",renderAll:!0,bubble:!0}))};var b=this;this.onKeyup=function(e){switch(e.which){case 13:r();break;case 8:o()}}},REE.LineControl.prototype=Object.create(REE.Control.prototype),REE.LineControl.prototype.constructor=REE.LineControl}();
!function(){"use strict";var e,t=new THREE.Raycaster;REE.SelectionControl=function(o){function n(e,o){t.setFromCamera(e,i.camera),s=t.intersectObjects([i.scene],!0)[0],s?(c=s.object,o?i.selection.toggle(c):(i.selection.clear(),i.selection.add(c))):o||i.selection.clear()}REE.Control.call(this,o),this.helper.add(new REE.BoxHelper),this.helper.scale.set(1/0,1/0,1/0),this.addEventListener("selection.selection-changed",function(){e=this.selection.box.max.clone().sub(this.selection.box.min),this.helper.position.copy(this.selection.center),this.helper.scale.copy(e),this.dispatchEvent({type:"render",renderAll:!0,bubble:!0})}.bind(this));var s,c,i=this;this.onTrackend=function(e,t){t[0].offset.length()<.01&&n(t[0].position,e.shiftKey)},this.onKeyup=function(e,t){switch(t){case 38:i.selection.selectParents(c);break;case 40:i.selection.selectChildren(c);break;case 39:i.selection.selectNext(c);break;case 37:i.selection.selectPrevious(c)}}},REE.SelectionControl.prototype=Object.create(REE.Control.prototype),REE.SelectionControl.prototype.constructor=REE.SelectionControl}();
!function(){"use strict";var t,a,e,r,i,o,c,s,h=new THREE.Vector3,n=new THREE.Matrix3,m=1e-6;REE.ViewportControl=function(t){REE.Control.call(this,t);var a=this;this.onTrack=function(t,e){if("mousemove"===t.type)0===t.button&&(a.camera instanceof THREE.OrthographicCamera?a.pan(e[0].delta):a.rotate(e[0].delta)),1===t.button&&a.zoom(e[0].delta),2===t.button&&a.pan(e[0].delta);else if("touchmove"===t.type)switch(e.length){case 1:a.camera instanceof THREE.PerspectiveCamera?a.rotate(e[0].delta):a.camera instanceof THREE.OrthographicCamera&&a.pan(e[0].delta);break;case 2:var r=e[0].previous.distanceTo(e[1].previous),i=e[0].position.distanceTo(e[1].position);r&&(a.zoom(new THREE.Vector2(0,r-i)),a.pan(e[0].delta.clone().add(e[1].delta).multiplyScalar(.5)))}},this.onTrackend=function(){a.camera.dispatchEvent({type:"changed"})},this.onMousewheel=function(t,e){void 0!==this.camera&&a.zoom(new THREE.Vector2(0,e/1e3))},this.onKeyup=function(t,e){70===e&&a.focusSelection()}},REE.ViewportControl.prototype=Object.create(REE.Control.prototype),REE.ViewportControl.prototype.constructor=REE.ViewportControl,REE.ViewportControl.prototype.rotate=function(r){this.camera._target=this.camera._target||new THREE.Vector3,h.copy(this.camera.position).sub(this.camera._target),t=Math.atan2(h.x,h.z),a=Math.atan2(Math.sqrt(h.x*h.x+h.z*h.z),h.y),t-=3*r.x,a-=3*-r.y,a=Math.max(m,Math.min(Math.PI-m,a)),e=h.length(),h.x=e*Math.sin(a)*Math.sin(t),h.y=e*Math.cos(a),h.z=e*Math.sin(a)*Math.cos(t),this.camera.position.copy(this.camera._target).add(h),this.camera.lookAt(this.camera._target),this.dispatchEvent({type:"render",bubble:!0})},REE.ViewportControl.prototype.pan=function(t){this.camera._target=this.camera._target||new THREE.Vector3,r=this.camera.position.distanceTo(this.camera._target),h.set(-t.x,-t.y,0),this.camera instanceof THREE.PerspectiveCamera?(i=r*Math.tan(this.camera.fov/2*Math.PI/180),h.multiplyScalar(i),h.x*=this.camera.aspect):this.camera instanceof THREE.OrthographicCamera&&(h.x*=(this.camera.right-this.camera.left)/2,h.y*=(this.camera.top-this.camera.bottom)/2),h.applyMatrix3(n.getNormalMatrix(this.camera.matrix)),this.camera.position.add(h),this.camera._target.add(h),this.dispatchEvent({type:"render",bubble:!0})},REE.ViewportControl.prototype.zoom=function(t){if(this.camera._target=this.camera._target||new THREE.Vector3,this.camera instanceof THREE.PerspectiveCamera){var a=this.camera.position.distanceTo(this.camera._target);if(h.set(0,0,t.y),h.multiplyScalar(a),h.length()>a)return;h.applyMatrix3(n.getNormalMatrix(this.camera.matrix)),this.camera.position.add(h)}else this.camera instanceof THREE.OrthographicCamera&&(this.camera.top*=1+t.y,this.camera.right*=1+t.y,this.camera.bottom*=1+t.y,this.camera.left*=1+t.y);this.dispatchEvent({type:"render",bubble:!0})},REE.ViewportControl.prototype.focusSelection=function(){if(this.camera._target=this.camera._target||new THREE.Vector3,this.selection&&this.selection.objects.length&&this.selection.sphere.radius){var t=this.selection.sphere.radius,a=this.camera.position.clone().sub(this.camera._target);if(this.camera instanceof THREE.PerspectiveCamera){this.camera._target.copy(this.selection.center);var e=Math.tan(this.camera.fov/2*Math.PI/180);a.normalize().multiplyScalar(t/e),this.camera.position.copy(this.camera._target).add(a),this.camera.lookAt(this.camera._target)}else this.camera instanceof THREE.OrthographicCamera&&(this.camera._target.copy(this.selection.center),this.camera.position.copy(this.camera._target).add(a),o=this.camera.right-this.camera.left,c=this.camera.top-this.camera.bottom,s=o/c,1>s?(this.camera.top=t/s,this.camera.right=t,this.camera.bottom=-t/s,this.camera.left=-t):(this.camera.top=t,this.camera.right=t*s,this.camera.bottom=-t,this.camera.left=-t*s));this.dispatchEvent({type:"render",bubble:!0})}}}();
!function(){"use strict";REE.SphereControl=function(e){REE.Control.call(this,e);var t,o,i,n=new THREE.Mesh(new THREE.SphereGeometry(1,32,32),new THREE.MeshBasicMaterial({color:16777215,wireframe:!0}));this.onTrackstart=function(e,o){e.altKey||(t=this.getPointOnPlane(o[0].position,e.shiftKey),t&&(this.helper.add(n),n.visible=!1,n.position.copy(t),this.active=!0))},this.onTrack=function(e,r){e.altKey||(o=this.getPointOnPlane(r[0].position,e.shiftKey),o&&(i=t.distanceTo(o),i>0&&(n.scale.set(i,i,i),n.visible=!0,this.dispatchEvent({type:"render",bubble:!0}))))},this.onTrackend=function(e){if(!e.altKey){if(this.helper.remove(n),i>0){var o=new THREE.Mesh(new THREE.SphereGeometry(i,32,32),new THREE.MeshNormalMaterial({color:16777215}));o.position.copy(t),this.scene.add(o),this.selection.clear(),this.selection.add(o)}this.active=!1,i=0,this.dispatchEvent({type:"render",renderAll:!0,bubble:!0})}}},REE.SphereControl.prototype=Object.create(REE.Control.prototype),REE.SphereControl.prototype.constructor=REE.SphereControl}();
!function(){"use strict";var t,e,i,o=new THREE.Vector3,a=new THREE.Quaternion,n=new THREE.Matrix4,s=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),l=new THREE.Vector3(0,0,1),c=new THREE.Vector3(0,0,0),h=new THREE.Raycaster;REE.TransformControl=function(t){function i(){for(var t=d.selection.objects,e=0;e<t.length;e++)t[e].hasOwnProperty("_positionStart")||Object.defineProperties(t[e],{_positionStart:{value:new THREE.Vector3},_quaternionStart:{value:new THREE.Quaternion},_scaleStart:{value:new THREE.Vector3}}),t[e]._positionStart.copy(t[e].position),t[e]._quaternionStart.copy(t[e].quaternion),t[e]._scaleStart.copy(t[e].scale)}function o(t){for(var e=d.selection.objects,i=d.axis,o=d.space,n=0;n<e.length;n++)"local"===o?e[n].position.copy(V).applyQuaternion(e[n]._quaternionStart):e[n].position.copy(T),e[n].position.add(e[n]._positionStart),t&&d.snapDistance&&("local"===o&&(e[n].position.applyQuaternion(a.copy(e[n]._quaternionStart).inverse()),-1!==i.search("X")&&(e[n].position.x=Math.round(e[n].position.x/d.snapDistance)*d.snapDistance),-1!==i.search("Y")&&(e[n].position.y=Math.round(e[n].position.y/d.snapDistance)*d.snapDistance),-1!==i.search("Z")&&(e[n].position.z=Math.round(e[n].position.z/d.snapDistance)*d.snapDistance),e[n].position.applyQuaternion(e[n]._quaternionStart)),"world"===o&&(e[n].parent&&e[n].position.add(q.setFromMatrixPosition(e[n].parent.matrixWorld)),-1!==i.search("X")&&(e[n].position.x=Math.round(e[n].position.x/d.snapDistance)*d.snapDistance),-1!==i.search("Y")&&(e[n].position.y=Math.round(e[n].position.y/d.snapDistance)*d.snapDistance),-1!==i.search("Z")&&(e[n].position.z=Math.round(e[n].position.z/d.snapDistance)*d.snapDistance),e[n].parent&&e[n].position.sub(q.setFromMatrixPosition(e[n].parent.matrixWorld))))}function n(){for(var t=d.selection.objects,e=0;e<t.length;e++)t[e].scale.copy(t[e]._scaleStart).multiply(w)}function c(t){var i=d.selection.objects,o=d.axis,a=d.space;("E"===o||"XYZE"===o)&&(a="world");for(var n=0;n<i.length;n++)"local"===a?(i[n].quaternion.copy(i[n]._quaternionStart),i[n].quaternion.multiply(k)):(i[n].quaternion.copy(R),i[n].quaternion.multiply(i[n]._quaternionStart)),t&&d.snapAngle&&(e=d.snapAngle/180*Math.PI)}function h(t){t&&(i(),d.target.updateMatrixWorld(),E=d.target.matrixWorld.clone(),y.extractRotation(E),g.setFromMatrixPosition(E),x.copy(t).sub(g),M.copy(x),M.applyMatrix4(H.getInverse(y)),d.dispatchEvent({type:"transformstart"}))}function p(t,e,i){if(t){var a,h=d.axis;b.copy(t).sub(g),T.subVectors(b,x),v.copy(b),v.applyMatrix4(H.getInverse(y)),V.subVectors(v,M),f.copy(b).cross(x),A.copy(v).cross(M),"translate"===d.mode?(-1===h.search("X")&&(T.x=0,V.x=0),-1===h.search("Y")&&(T.y=0,V.y=0),-1===h.search("Z")&&(T.z=0,V.z=0),o(e)):"scale"===d.mode?("XYZ"===h?w.set(T.y/50,T.y/50,T.y/50).addScalar(1):w.set("X"===h?V.x/50:0,"Y"===h?V.y/50:0,"Z"===h?V.z/50:0).addScalar(1),n()):"rotate"===d.mode&&("E"===h?(A.applyMatrix4(y).normalize(),a=A.dot(d.eye)<0?1:-1,R.setFromAxisAngle(d.eye,v.angleTo(M)*a)):"XYZE"===h?(q.copy(T).cross(d.eye).normalize(),R.setFromAxisAngle(q,-2*i.length())):"X"===h?(k.setFromAxisAngle(s,v.angleTo(M)*(A.x>0?-1:1)),R.setFromAxisAngle(s,b.angleTo(x)*(f.x>0?-1:1))):"Y"===h?(k.setFromAxisAngle(r,v.angleTo(M)*(A.y>0?-1:1)),R.setFromAxisAngle(r,b.angleTo(x)*(f.y>0?-1:1))):"Z"===h&&(k.setFromAxisAngle(l,v.angleTo(M)*(A.z>0?-1:1)),R.setFromAxisAngle(l,b.angleTo(x)*(f.z>0?-1:1))),c(e)),d.dispatchEvent({type:"transform"}),d.dispatchEvent({type:"render",bubble:!0})}}function m(){d.selection.update(),d.dispatchEvent({type:"transformend"}),d.dispatchEvent({type:"render",renderAll:!0,bubble:!0})}REE.Control.call(this,t);var d=this;this.registerProperties({target:{type:THREE.Object3D,notify:!0},mode:{value:"translate",observer:"modeChanged"},size:{value:1,type:Number,notify:!0},axis:{value:"",type:String,observer:"axisChanged",notify:!0},space:{value:"local",type:String,notify:!0}}),this.helper.visible=!1,this.plane.update=this.updatePlane.bind(this),this.gnomon=new THREE.Object3D,this.helper.add(this.gnomon),this.helper.update=function(t){this.updateTransform(t),this.updateVisibility()}.bind(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.gnomon.add(this.handles),this.gnomon.add(this.pickers),this._handleModes={translate:this.makeGizmoTranslate(),rotate:this.makeGizmoRotate(),scale:this.makeGizmoScale()},this._pickerModes={translate:this.makePickerTranslate(),rotate:this.makePickerRotate(),scale:this.makePickerScale()},this.position=new THREE.Vector3,this.scale=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.eye=new THREE.Vector3,this.alignVector=new THREE.Vector3,this.addEventListener("selection.selection-changed",this.setTargetFromSelection.bind(this)),this.setTargetFromSelection();var u,E=new THREE.Matrix4,y=new THREE.Matrix4,g=new THREE.Vector3,b=new THREE.Vector3,x=new THREE.Vector3,T=new THREE.Vector3,f=new THREE.Vector3,R=new THREE.Quaternion,v=new THREE.Vector3,M=new THREE.Vector3,V=new THREE.Vector3,A=new THREE.Vector3,k=new THREE.Quaternion,w=new THREE.Vector3,H=new THREE.Matrix4,q=new THREE.Vector3;this.onHover=function(t,e){this.setAxis(e[0]),this.plane.position.copy(this.gnomon.position)},this.onTrackstart=function(t,e){this.target&&(this.setAxis(e[0]),u=this.getPointOnPlane(e[0].position),this.active=""!==this.axis,h(u,t.shiftKey))},this.onTrack=function(t,e){if(this.target){u=this.getPointOnPlane(e[0].position);var i=e[0].offset;u&&this.active&&p(u,t.shiftKey,i)}},this.onTrackend=function(){m(),this.axis="",this.active=!1},this.onKeyup=function(t,e){switch(e){case 87:this.mode="translate";break;case 69:this.mode="rotate";break;case 82:this.mode="scale";break;case 81:this.space="local"===this.space?"world":"local"}"scale"===this.mode&&(this.space="local")}},REE.TransformControl.prototype=Object.create(REE.Control.prototype),REE.TransformControl.prototype.constructor=REE.TransformControl,REE.TransformControl.prototype.updateTransform=function(e){this.target&&(e=e||this.camera,e.updateMatrixWorld(),this.target.updateMatrixWorld(),this.position.setFromMatrixPosition(this.target.matrixWorld),this.scale.setFromMatrixScale(this.target.matrixWorld),this.quaternion.set(0,0,0,1),"local"===this.space&&(n.extractRotation(this.target.matrixWorld),this.quaternion.setFromRotationMatrix(n)),e instanceof THREE.OrthographicCamera?(t=(e.top-e.bottom)/3*this.size,this.eye.copy(l).applyMatrix4(n.extractRotation(e.matrixWorld)).normalize()):(o.setFromMatrixPosition(e.matrixWorld).sub(this.position),t=o.length()/6*this.size,this.eye.copy(o).normalize()),this.gnomon.position.copy(this.position),this.gnomon.scale.set(t,t,t),this.alignVector.copy(this.eye).applyQuaternion(a.copy(this.quaternion).inverse()),this.gnomon.traverse(function(t){-1!==t.name.search("E")?(n.lookAt(this.eye,c,r),t.quaternion.setFromRotationMatrix(n)):""!==t.name&&t.quaternion.copy(this.quaternion),"rotate"===this.mode&&("X"===t.name&&(a.setFromAxisAngle(s,Math.atan2(-this.alignVector.y,this.alignVector.z)),a.multiplyQuaternions(this.quaternion,a),t.quaternion.copy(a)),"Y"===t.name&&(a.setFromAxisAngle(r,Math.atan2(this.alignVector.x,this.alignVector.z)),a.multiplyQuaternions(this.quaternion,a),t.quaternion.copy(a)),"Z"===t.name&&(a.setFromAxisAngle(l,Math.atan2(this.alignVector.y,this.alignVector.x)),a.multiplyQuaternions(this.quaternion,a),t.quaternion.copy(a)))}.bind(this)),this.gnomon.updateMatrixWorld())},REE.TransformControl.prototype.updateVisibility=function(){return this.target&&this.enabled?(this.helper.visible=!0,void this.gnomon.traverse(function(t){t.visible=!0,"translate"===this.mode||"scale"===this.mode?Math.abs(this.alignVector.x)>.99?("X"===t.name||"XY"===t.name||"XZ"===t.name)&&(t.visible=!1):Math.abs(this.alignVector.y)>.99?("Y"===t.name||"XY"===t.name||"YZ"===t.name)&&(t.visible=!1):Math.abs(this.alignVector.z)>.99&&("Z"===t.name||"XZ"===t.name||"YZ"===t.name)&&(t.visible=!1):"rotate"===this.mode&&(Math.abs(this.alignVector.x)<.1&&"X"===t.name&&(t.visible=!1),Math.abs(this.alignVector.y)<.1&&"Y"===t.name&&(t.visible=!1),Math.abs(this.alignVector.z)<.1&&"Z"===t.name&&(t.visible=!1))}.bind(this))):void(this.helper.visible=!1)},REE.TransformControl.prototype.updatePlane=function(t){if(t&&""!==this.axis){switch(this.axis){case"X":this.plane.lookAt(s);break;case"Y":this.plane.lookAt(r);break;case"Z":this.plane.lookAt(l);break;case"XY":this.plane.lookAt(l);break;case"YZ":this.plane.lookAt(s);break;case"XZ":this.plane.lookAt(r);break;case"XYZ":this.plane.lookAt(this.eye)}("translate"===this.mode||"scale"===this.mode)&&("X"===this.axis&&(this.plane.lookAt(r),Math.abs(this.alignVector.z)>Math.abs(this.alignVector.y)&&this.plane.lookAt(l)),"Y"===this.axis&&(this.plane.lookAt(l),Math.abs(this.alignVector.x)>Math.abs(this.alignVector.z)&&this.plane.lookAt(s)),"Z"===this.axis&&(this.plane.lookAt(r),Math.abs(this.alignVector.x)>Math.abs(this.alignVector.y)&&this.plane.lookAt(s))),"E"===this.axis||"rotate"===this.mode?this.plane.lookAt(this.eye):"local"===this.space&&(a.copy(this.plane.quaternion),this.plane.quaternion.copy(this.quaternion).multiply(a)),this.plane.updateMatrixWorld()}},REE.TransformControl.prototype.axisChanged=function(){this.handles.traverse(function(t){t.material&&(t.material.oldColor=t.material.oldColor||t.material.color.clone(),t.material.oldOpacity=t.material.oldOpacity||t.material.opacity,t.name===this.axis?(t.material.color.setRGB(1,1,0),t.material.opacity=1):(t.material.color.copy(t.material.oldColor),t.material.opacity=t.material.oldOpacity))}.bind(this))},REE.TransformControl.prototype.modeChanged=function(){for(var t=this.gnomon.children.length;t--;)this.gnomon.remove(this.gnomon.children[t]);this.mode&&(this.handles=this._handleModes[this.mode],this.pickers=this._pickerModes[this.mode],this.gnomon.add(this.handles),this.gnomon.add(this.pickers),this.dispatchEvent({type:"render",renderAll:!0,bubble:!0}))},REE.TransformControl.prototype.setAxis=function(t){this.helper.update(this.camera),h.setFromCamera(t.position,this.camera),i=h.intersectObjects([this.pickers],!0)[0],i&&i.object.name?i.object.name!==this.axis&&(this.axis=i.object.name):this.axis="",this.dispatchEvent({type:"render",bubble:!0})},REE.TransformControl.prototype.setTargetFromSelection=function(){this.selection.objects.length?this.target=this.selection.objects[this.selection.objects.length-1]:this.target=void 0}}();
!function(){"use strict";var e=new THREE.MeshBasicMaterial;e.depthTest=!1,e.depthWrite=!1,e.transparent=!0,e.side=THREE.FrontSide;var t=new THREE.LineBasicMaterial;t.depthTest=!1,t.depthWrite=!1,t.transparent=!0;var n=e.clone();n.visible=!1,n.transparent=!1,n.opacity=.5;var r=e.clone();r.color.set(16711680);var E=e.clone();E.color.set(65280);var o=e.clone();o.color.set(255);var a=e.clone();a.opacity=.25;var T=a.clone();T.color.set(16776960);var s=a.clone();s.color.set(65535);var R=a.clone();R.color.set(16711935);var i=e.clone();i.color.set(16776960);var w=t.clone();w.color.set(16711680);var H=t.clone();H.color.set(65280);var h=t.clone();h.color.set(255);var M=t.clone();M.color.set(16776960);var l=t.clone();l.color.set(7895160);var c=M.clone();c.opacity=.25;var m=new THREE.Geometry,y=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,!1));y.position.y=.5,y.updateMatrix(),m.merge(y.geometry,y.matrix);var u=new THREE.Geometry,p=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125));p.position.y=.5,p.updateMatrix(),u.merge(p.geometry,p.matrix);var f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3));var P=new THREE.BufferGeometry;P.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var v=new THREE.BufferGeometry;v.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3));var G=function(e,t,n){var r=new THREE.BufferGeometry,E=[];n=n?n:1;for(var o=0;64*n>=o;++o)"x"===t&&E.push(0,Math.cos(o/32*Math.PI)*e,Math.sin(o/32*Math.PI)*e),"y"===t&&E.push(Math.cos(o/32*Math.PI)*e,0,Math.sin(o/32*Math.PI)*e),"z"===t&&E.push(Math.sin(o/32*Math.PI)*e,Math.cos(o/32*Math.PI)*e,0);return r.addAttribute("position",new THREE.Float32Attribute(E,3)),r},d={X:[[new THREE.Mesh(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,w)]],Y:[[new THREE.Mesh(m,E),[0,.5,0]],[new THREE.Line(P,H)]],Z:[[new THREE.Mesh(m,o),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(v,h)]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),a),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),T),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),R),[.15,0,.15],[-Math.PI/2,0,0]]]},I={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),n)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),n),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},X={X:[[new THREE.Line(new G(1,"x",.5),w)]],Y:[[new THREE.Line(new G(1,"y",.5),H)]],Z:[[new THREE.Line(new G(1,"z",.5),h)]],E:[[new THREE.Line(new G(1.25,"z",1),c)]],XYZE:[[new THREE.Line(new G(1,"z",1),l)]]},Y={X:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),n)]],XYZE:[[new THREE.Mesh(new THREE.SphereGeometry(.95,8,8),n)]]},Z={X:[[new THREE.Mesh(u,r),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,w)]],Y:[[new THREE.Mesh(u,E),[0,.5,0]],[new THREE.Line(P,H)]],Z:[[new THREE.Mesh(u,o),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(v,h)]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),a)]]},B={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),n)]]},C=function(e){var t=new THREE.Object3D;for(var n in e){var r=new THREE.Object3D;t.add(r),t[n]=r;for(var E=e[n].length;E--;){var o=e[n][E][0].clone(),a=e[n][E][1],T=e[n][E][2];o.name=n,a&&o.position.set(a[0],a[1],a[2]),T&&o.rotation.set(T[0],T[1],T[2]),o.updateMatrix();var s=o.geometry.clone();s.applyMatrix(o.matrix),o.geometry=s,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),r.add(o)}}return t};REE.TransformControl.prototype.makeGizmoTranslate=function(){return C(d)},REE.TransformControl.prototype.makeGizmoRotate=function(){return C(X)},REE.TransformControl.prototype.makeGizmoScale=function(){return C(Z)},REE.TransformControl.prototype.makePickerTranslate=function(){return C(I)},REE.TransformControl.prototype.makePickerRotate=function(){return C(Y)},REE.TransformControl.prototype.makePickerScale=function(){return C(B)}}();